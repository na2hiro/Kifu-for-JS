<html lang="ja">
    <head>
        <title>Kifu for JS example</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <style>
            #hachimai + ins > svg {
                border: 1px black solid;
            }
        </style>
    </head>

    <body>
        <h1>Kifu for JS v5 最新方式と旧方式の混在動作例</h1>

        <a href="./example-v4.html">v4</a>

        <p>
            こちらは動作確認用のページです。使い方などについては<a href="https://kifu-for-js.81.la"
                >Kifu for JS公式サイト</a
            >を参照してください。
        </p>

        読み込むスクリプト：<select id="dropdown" onchange="location.href='?bundle='+event.target.value">
            <option value="kifu-for-js">kifu-for-js.min.js (最新バンドル)</option>
            <option value="kifu-for-js-legacy">kifu-for-js-legacy.min.js (Legacy込みバンドル)</option>
        </select>
        <script src="./bundle-loader.js"></script>

        <script>
            KifuForJS.load("./files/ki2/9fu.ki2", "ki2dom");
        </script>

        <h2><a id="example">例</a></h2>

        <h3>各種読み込み方式</h3>
        <h4>タグ方式（棋譜埋め込み）</h4>
        <script type="text/kifu">
            # KIF形式棋譜ファイル
            # Generated by Shogidokoro
            後手の持駒：飛　金三　銀三　桂二　香四　歩十三
              ９ ８ ７ ６ ５ ４ ３ ２ １
            +---------------------------+
            | ・ ・ ・ ・ 馬 ・ ・v桂 ・|一
            | ・ ・ ・ ・ ・ ・ ・v玉 ・|二
            | ・ ・ ・ ・ ・ ・v歩v歩 ・|三
            | ・ ・ ・ ・ ・ ・ ・v金v歩|四
            | ・ ・ ・ ・ 歩 ・ ・ ・ 歩|五
            | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
            | ・ ・ ・ ・ ・ ・ ・ ・ ・|七
            | ・ ・ ・ ・ ・ ・ ・ ・ ・|八
            | ・ ・ ・ ・ ・ ・ ・ ・ ・|九
            +---------------------------+
            先手の持駒：飛　角　銀　桂
            先手：
            後手：
            手数----指手---------消費時間--
               1 ５二飛打      (00:31 / 00:00:31)
               2 ３二金打      (00:00 / 00:00:00)
               3 ３一角打      (00:00 / 00:00:31)
               4 同　玉(22)    (00:00 / 00:00:00)
        </script>

        <h4>タグ方式（外部ファイル）</h4>
        <script type="text/kifu" data-src="./files/kif/jt201409130101.kif"></script>

        <h4>Kifu for Java/Flashの自動解釈</h4>
        （未実装）

        <h4><a id="kiflite">JavaScript関数による動的読み込み (lite)</a></h4>
        <div id="kiflite-container" style="max-width: 600px"></div>
        <script>
            var kifuLite = KifuForJS.load("./files/kif/jt201409130101.kif", "kiflite-container", { mode: "latest" });
        </script>

        <h4><a id="kif">JavaScript関数による動的読み込み (legacy)</a></h4>
        <div id="kif-container" style="max-width: 600px"></div>
        <script>
            var kifu = KifuForJS.load("./files/kif/jt201409130101.kif", "kif-container");
        </script>

        <h4><a>タグ方式（棋譜埋め込み、実体参照を使用したブログ等）</a></h4>
        <script type="text/kifu">
            後手の持駒&#65306;飛二&#12288;金四&#12288;桂四&#12288;香四&#12288;歩十八
              ９ ８ ７ ６ ５ ４ ３ ２ １
            +---------------------------+
            | &#12539; &#12539; &#12539;v銀v玉v銀 &#12539; &#12539; &#12539;|一
            | &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539;|二
            | &#12539; &#12539; &#12539; &#12539; 銀 &#12539; &#12539; &#12539; &#12539;|三
            | &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539;|四
            | &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539;|五
            | &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; 角|六
            | &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539;|七
            | &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539;|八
            | &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539; &#12539;|九
            +---------------------------+
            先手の持駒&#65306;銀
            *最も有名な古典詰将棋&#12290;
            *銀で押さえ込むのは難しそうに見えるが&#65311;
            &#9650;５二角成
            *焦点の捨て駒が好手&#12290;
            &#9651;同銀右 &#9650;６二銀打
            *どちらで取っても玉のコビンが空いて詰み&#12290;
            まで3手で詰み
        </script>

        <h4><a>タグ方式、エラー</a></h4>
        <script type="text/kifu">
            ▲５三量子直不成
        </script>

        <h3>色々な棋譜</h3>
        <h4>分岐棋譜（タグ方式）</h4>
        <script type="text/kifu" data-src="./files/kif/fork.kif"></script>

        <h4>KI2形式</h4>
        <div id="ki2dom"></div>

        <h3><a id="csa">CSA形式</a></h3>
        <script type="text/kifu" data-src="./files/csa/8mai.csa"></script>

        <h3><a id="jkf">JKF形式</a></h3>
        <script type="text/kifu" data-src="./files/jkf/ryuou201409020101.jkf"></script>

        <h3>各種設定</h3>
        <h4>デフォルトオプション</h4>
        佐藤さんの視点で表示
        <script>
            KifuForJS.setDefaultOptions({ reverse: { name: "佐藤" } });
        </script>

        <h4>X手目から</h4>
        <script type="text/kifu" data-src="./files/csa/8mai.csa" data-ply="10" id="hachimai"></script>
        <h4>分岐局面から</h4>
        <script type="text/kifu" data-src="./files/kif/fork.kif" data-ply="3" data-forkPointers="[[1, 0]]"></script>
        <h4>反転</h4>
        <script type="text/kifu" data-src="./files/csa/8mai.csa" data-reverse></script>
        <h4>対局者名による自動反転</h4>
        <script type="text/kifu" data-src="./files/csa/8mai.csa" data-reverse-name="uwa"></script>

        <h4>図面モード</h4>
        <script type="text/kifu" data-ply="3" data-forkPointers="[[1, 0]]" data-static>
            #KIF version=2.0 encoding=Shift_JIS
            # ---- Kifu for Windows V7 V7.08 棋譜ファイル ----
            開始日時：2014/10/16 03:21:41
            終了日時：2014/10/18 18:46:58
            手合割：平手　　
            先手：
            後手：
            手数----指手---------消費時間--
               1 ７六歩(77)   ( 0:02/00:00:02)+
               2 ３四歩(33)   ( 0:01/00:00:01)+
               3 ２六歩(27)   ( 0:01/00:00:03)+
               4 投了         ( 0:00/00:00:01)
            まで3手で先手の勝ち

            変化：3手
               3 ７五歩(76)   ( 0:01/00:00:03)
               4 中断         ( 0:00/00:00:01)
            まで3手で中断

            変化：2手
               2 ８四歩(83)   ( 0:07/00:00:07)
               3 ６八銀(79)   ( 0:02/00:00:04)+
               4 持将棋       ( 0:00/00:00:07)
            まで3手で持将棋

            変化：3手
               3 ２六歩(27)   ( 0:08/00:00:10)
               4 切れ負け     ( 0:00/00:00:07)
            まで3手で時間切れにより先手の勝ち

            変化：1手
               1 ２六歩(27)   ( 0:05/00:00:05)
               2 ３四歩(33)   ( 0:03/00:00:03)+
               3 ２五歩(26)   ( 0:01/00:00:06)+
               4 反則勝ち     ( 0:00/00:00:03)
            まで3手で後手の反則勝ち

            変化：3手
               3 ７六歩(77)   ( 0:04/00:00:09)
               4 千日手       ( 0:00/00:00:03)
            まで3手で千日手

            変化：2手
               2 ８四歩(83)   ( 0:01/00:00:01)
               3 ２五歩(26)   ( 0:01/00:00:06)+
               4 詰み         ( 0:00/00:00:01)
            まで3手で詰

            変化：3手
               3 ７六歩(77)   ( 0:02/00:00:07)
               4 不詰         ( 0:00/00:00:01)
            まで3手で不詰
        </script>

        <h4>図面モード(SFEN)</h4>
        <script type="text/kifu" data-static>
            ln1gkg1nl/6+P2/2sppps1p/2p3p2/p8/P1P1P3P/2NP1PP2/3s1KSR1/L1+b2G1NL w R2Pbgp 42
        </script>

        <h4>図面モード(BOD)</h4>
        <script type="text/kifu" data-static>
            作品名：不明
            後手の持駒：飛　金三　銀三　桂二　香四　歩十三
              ９ ８ ７ ６ ５ ４ ３ ２ １
            +---------------------------+
            | ・ ・ ・ ・ 馬 ・ ・v桂 ・|一
            | ・ ・ ・ ・ ・ ・ ・v玉 ・|二
            | ・ ・ ・ ・ ・ ・v歩v歩 ・|三
            | ・ ・ ・ ・ ・ ・ ・v金v歩|四
            | ・ ・ ・ ・ 歩 ・ ・ ・ 歩|五
            | ・ ・ ・ ・ ・ ・ ・ ・ ・|六
            | ・ ・ ・ ・ ・ ・ ・ ・ ・|七
            | ・ ・ ・ ・ ・ ・ ・ ・ ・|八
            | ・ ・ ・ ・ ・ ・ ・ ・ ・|九
            +---------------------------+
            先手の持駒：飛　角　銀　桂
            先手：
            後手：
        </script>

        <h4>図面モード、着手表示抑制</h4>
        <script
            type="text/kifu"
            data-src="./files/csa/8mai.csa"
            data-ply="10"
            data-static
            data-static-last="hidden"
        ></script>

        <h4>図面モード、着手表示指定</h4>
        <script type="text/kifu" data-static data-static-last="[3, 2]">
            ln1gkg1nl/6+P2/2sppps1p/2p3p2/p8/P1P1P3P/2NP1PP2/3s1KSR1/L1+b2G1NL w R2Pbgp 42
        </script>

        <h3>詰将棋モード</h3>

        <h4>自動判定</h4>
        <script type="text/kifu" data-src="./files/kif/32ryu-cumbersome.kif" data-tsume></script>

        <h4>手動設定</h4>
        <script type="text/kifu" data-src="./files/kif/32ryu-cumbersome.kif" data-tsume></script>

        <h4>玉方残り全部ではない場合</h4>
        <script type="text/kifu" data-src="./files/ki2/9fu.ki2"></script>

        <h4>玉方の持駒を省略しない設定</h4>
        <script type="text/kifu" data-tsume data-tsume-kingsHand data-src="./files/kif/kanju-kemuri.kif"></script>

        <h4>解を隠す</h4>
        <script type="text/kifu" data-tsume data-tsume-hideAnswer data-src="./files/kif/hashimoto-sos.kif"></script>

        <h4>出典付記設定</h4>
        <script type="text/kifu" data-tsume data-tsume-citation data-src="./files/kif/hashimoto-sos.kif"></script>

        <h4>持駒表示設定＆出典付記設定</h4>
        <script
            type="text/kifu"
            data-tsume
            data-tsume-kingsHand
            data-tsume-citation
            data-src="./files/kif/hashimoto-sos.kif"
        ></script>

        <h4>図面モードと併用</h4>
        <script type="text/kifu" data-src="./files/kif/32ryu-cumbersome.kif" data-tsume data-static></script>

        <h4>図面モードと併用＆持駒表示設定＆出典付記設定</h4>
        <script
            type="text/kifu"
            data-static
            data-tsume
            data-tsume-kingsHand
            data-tsume-citation
            data-src="./files/kif/hashimoto-sos.kif"
        ></script>

        <h3><a id="text">テキスト読み込み＆JSからのテキスト再読み込み</a></h3>
        <script>
            var kifu = KifuForJS.loadString("▲７六歩  △８四歩  ▲６八銀");
        </script>
        <textarea id="kifuString" aria-label="棋譜">
  ▲７六歩  △８四歩  ▲６八銀
</textarea
        >
        <button onclick="kifu.then(kifuStore => kifuStore.loadKifu(document.getElementById('kifuString').value))">
            読み込み
        </button>

        <h2><a id="example-mobx">mobxによる状態監視の例</a></h2>
        <h3><a id="mobx-tag">タグ方式</a></h3>
        <div>
            現在<span id="tesuu-tag" style="font-size: large"></span>手目です!
            <button
                onclick="KifuForJS.getKifuStore(document.getElementById('mobx-tag-board')).then((kifuStore) =>kifuStore.player.goto(Math.floor(Math.random()*100)))"
            >
                適当な局面にジャンプ
            </button>
        </div>
        <script type="text/kifu" data-src="./files/kif/jt201409130101.kif" id="mobx-tag-board"></script>
        <script>
            KifuForJS.getKifuStore(document.getElementById("mobx-tag-board")).then((kifuStore) => {
                KifuForJS.mobx.autorun(() => {
                    document.getElementById("tesuu-tag").textContent = kifuStore.player.tesuu;
                });
            });
        </script>

        <h3><a id="mobx-js">JavaScript方式</a></h3>
        <div>
            現在<span id="tesuu-js" style="font-size: large"></span>手目です!
            <button onclick="myKifuStore.player.goto(Math.floor(Math.random()*100))">適当な局面にジャンプ</button>
        </div>
        <script>
            KifuForJS.load("./files/kif/jt201409130101.kif").then((kifuStore) => {
                window.myKifuStore = kifuStore;
                KifuForJS.mobx.autorun(() => {
                    document.getElementById("tesuu-js").textContent = kifuStore.player.tesuu;
                });
            });
        </script>
    </body>
</html>
