/*! For license information please see KifuInBookmarklet.min.js.LICENSE.txt */
(self.webpackChunkkifu_for_js=self.webpackChunkkifu_for_js||[]).push([[113],{3739:(t,e,r)=>{"use strict";r.r(e),r.d(e,{KifuLite:()=>Ot,KifuStore:()=>Tt,getKifuStore:()=>Nt,load:()=>Mt,loadString:()=>Ut,mobx:()=>jt,mobxReact:()=>Ft}),r(8188),r(3439),r(2501),r(8233),r(7233),r(8673),r(4115),r(634),r(796),r(5735),r(6886);var n=r(3818),o=r(7076),i=r(2784),a=r(8316),u=(r(8625),r(8178),r(3450),r(5794),r(9575),r(6264),r(1245),r(6936),r(7950),r(9618)),l=r(1426);function c(t){"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?t():document.addEventListener("DOMContentLoaded",t)}function f(t){var e=t.split("\n").filter((function(t){return""!=t}))[0];if(!e)return t;var r=/(\s+)/.exec(e);if(!r)return t;var n=!1,o=t.split("\n").map((function(t){return t.startsWith(r[1])?t.slice(r[1].length):(""===t||(n=!0),t)})).join("\n");return n?t:o}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],l=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);l=!0);}catch(t){c=!0,o=t}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function d(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==p(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===p(o)?o:String(o)),n)}var o}function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}r(5342),r(6781),r(4112);var v=function(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"===("undefined"==typeof Reflect?"undefined":p(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a},m=function(t,e){return"棋譜形式エラー: この棋譜ファイルを @na2hiro までお寄せいただければ対応します．\n".concat(e,"\n=== 棋譜 ===\n").concat(t)},y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.signature=Math.random(),this.errors=[],this.player=new u.JKFPlayer({header:{},moves:[{}]});try{this.setOptions(e)}catch(t){console.error(t)}}var e,r;return e=t,r=[{key:"setOptions",value:function(t){var e,r=this;if(this.staticOptions=null==t?void 0:t.static,this.maxWidth=null===(null==t?void 0:t.maxWidth)?null:null!==(e=null==t?void 0:t.maxWidth)&&void 0!==e?e:400,t){var n=function(){t.ply&&r.player.goto(t.ply,t.forkPointers?t.forkPointers.map((function(t){var e=s(t,2);return{te:e[0],forkIndex:e[1]}})):void 0)};if(t.src)this.loadFile(t.src).catch((function(){})).then(n);else if(t.kifu&&""!==t.kifu.trim()){try{this.loadKifuSync(t.kifu.trim())}catch(e){if(t.static){var o=new l.WZ;try{o.initializeFromSFENString(t.kifu.trim()),this.player=u.JKFPlayer.fromShogi(o),this.errors=[]}catch(t){throw console.error(e),e}}}n()}}}},{key:"player",get:function(){return this.player_},set:function(t){(0,n.GW)(t,{forkPointers:n.LO,kifu:n.LO,tesuu:n.LO}),(0,n.GW)(t.shogi,{board:n.LO,hands:n.LO,turn:n.LO}),this.player_=t}},{key:"flip",value:function(){this.reversed=!this.reversed}},{key:"onInputMove",value:function(t){try{this.player.inputMove(t)||(t.promote=confirm("成りますか？"),this.player.inputMove(t))}catch(t){}}},{key:"loadKifu",value:function(t,e){var r=this;return new Promise((function(n){r.loadKifuSync(t,e),n()}))}},{key:"loadKifuSync",value:function(t,e){this.errors=[];try{var r=u.JKFPlayer.parse(t,e);g(r,this.player),this.player=r}catch(e){throw this.errors.push(m(t,e)),e}}},{key:"loadFile",value:function(t){var e=this;return this.errors=[],this.filePath=t,function(t){return new Promise((function(e,r){var n,o,i=(n=t.split("."),o=n[n.length-1],["jkf","kifu","ki2u"].indexOf(o)>=0?"UTF-8":"Shift_JIS");if("undefined"!=typeof document){var a=new XMLHttpRequest;a.open("GET",t,!0),a.overrideMimeType("text/html;charset="+i),a.onload=function(){if(304===this.status)e(null);else if(this.status>=200&&this.status<400)e(this.response);else{var n="棋譜ファイルが取得できません (".concat(this.status,"): ").concat(t);r(n)}},a.onerror=function(){var e="棋譜ファイルが取得できません: ".concat(t);"file:"===document.location.protocol&&(e+="\n\n【備考】\nAjaxのセキュリティ制約により，ローカルの棋譜の読み込みが制限されている可能性があります．\nページをサーバ上にアップロードして動作をご確認下さい．\nもしくは，棋譜ファイルのドラッグ&ドロップによる読み込み機能をお試し下さい．"),r(e)},a.send()}else console.info("This seems to be a server side rendering. Skip fetching file.")}))}(t).then((function(r){try{if(null===r)return;var n=u.JKFPlayer.parse(r,t);g(n,e.player),e.player=n}catch(t){throw e.errors.push(m(r,t)),console.error(t),t}}),(function(t){throw e.errors.push(t),t}))}},{key:"setReloadInterval",value:function(t){var e=this;this.timerAutoload&&clearInterval(this.timerAutoload);var r=parseInt(t,10);isNaN(r)||(this.timerAutoload=window.setInterval((function(){e.loadFile(e.filePath)}),1e3*r))}},{key:"hasFork",get:function(){return this.player.kifu.moves.some((function(t){return t.forks&&t.forks.length>0}))}},{key:"getLatestMoveTo",value:function(){var t,e;if("hidden"!==(null===(t=this.staticOptions)||void 0===t?void 0:t.last)){if(null===(e=this.staticOptions)||void 0===e?void 0:e.last){var r=s(this.staticOptions.last,2);return{x:r[0],y:r[1]}}var n=this.player.getMove();return!n&&this.player.tesuu>0&&(n=this.player.getMove(this.player.tesuu-1)),null==n?void 0:n.to}}}],r&&d(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function g(t,e){if(0!==e.tesuu){var r=e.tesuu===e.getMaxTesuu()?1/0:e.tesuu;t.goto(r)}}function k(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],l=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);l=!0);}catch(t){c=!0,o=t}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return b(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function x(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==K(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===K(o)?o:String(o)),n)}var o}function w(t,e){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},w(t,e)}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function A(t){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},A(t)}function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}v([n.LO],y.prototype,"errors",void 0),v([n.LO],y.prototype,"reversed",void 0),v([n.LO],y.prototype,"filePath",void 0),v([n.LO],y.prototype,"staticOptions",void 0),v([n.LO],y.prototype,"maxWidth",void 0),v([n.LO],y.prototype,"player_",void 0),r(4769),r(3105),r(5940),r(2506),r(6928),r(1229);var I=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e)}(u,t);var e,r,n,o,a=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=A(n);if(o){var r=A(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===K(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return E(t)}(this,t)});function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=a.call(this,t)).onChange=e.onChange.bind(E(e)),e}return e=u,r=[{key:"onChange",value:function(t){this.props.player.goto(t)}},{key:"render",value:function(){var t=this.props,e=t.player,r=t.style,n=e.getReadableKifuState().map((function(t,e){return{node:i.createElement(i.Fragment,null,i.createElement("span",{style:{fontFamily:"monospace"}},t.comments.length>0?"*":" "),i.createElement("span",{style:{display:"inline-block",minWidth:"20px",textAlign:"right"}},0===e||t.moveFormat.special?"":e.toString())," "+t.kifu+" "+t.forks.join(" ")),value:e}}));return i.createElement(C,{options:n,onChange:this.onChange,tesuu:e.tesuu,style:r})}}],r&&x(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(i.Component);const S=I=function(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"===("undefined"==typeof Reflect?"undefined":K(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a}([o.Pi],I);var C=function(t){var e=t.options,r=t.onChange,n=t.tesuu,o=t.style,a=k((0,i.useState)(null),2),u=a[0],l=a[1],c=k((0,i.useState)(null),2),f=c[0],s=c[1],h=k((0,i.useState)(null),2),d=h[0],p=h[1],v=(0,i.useRef)(),m=(0,i.useRef)();(0,i.useLayoutEffect)((function(){var t,e;m.current&&v.current&&(d!==n&&(t=m.current,(e=v.current).scrollTop=t.offsetTop+j(t)/2-j(e)/2),p(null))}),[n,u]),(0,i.useLayoutEffect)((function(){m.current&&!f&&s(j(m.current))}),[]),(0,i.useLayoutEffect)((function(){if(v.current){var t=j(v.current);u!==t&&l(t)}}));var y="".concat((u-f)/2-1,"px"),g=(0,i.useCallback)((function(){if(null!==u){var t=v.current.scrollTop+u/2;if(m.current.offsetTop>t){for(var e=m.current,o=1;e.previousElementSibling&&e.previousElementSibling.offsetTop>t;)e=e.previousElementSibling,o++;r(n-o),p(n-o)}else if(m.current.nextElementSibling&&m.current.nextElementSibling.offsetTop<t){for(var i=m.current.nextElementSibling,a=1;i.nextElementSibling&&i.nextElementSibling.offsetTop<t;)i=i.nextElementSibling,a++;r(n+a),p(n+a)}}}),[n,u,v.current,m.current]),b=(0,i.useCallback)((function(t){"ArrowDown"===t.key?(r(n+1),t.preventDefault()):"ArrowUp"===t.key&&(r(n-1),t.preventDefault())}),[n]);return i.createElement("div",{className:"kifuforjs-kifulist",onScroll:g,onKeyDown:b,ref:v,tabIndex:0,role:"listbox","aria-label":"手数",style:o},i.createElement("div",{className:"kifuforjs-kifulist-inner"},i.createElement("div",{style:{height:y}}),e.map((function(t){var e=t.node,o=t.value;return i.createElement("div",{key:o,role:"option",onClick:function(){return r(o)},"aria-selected":o===n,ref:o===n?m:null},e)})),i.createElement("div",{style:{height:y}})))};function j(t){return parseInt(getComputedStyle(t).height.replace("px",""),10)}r(1939);var F="一二三四五六七八九",O="currentColor",T=r(1142),U=["先手","後手"],M=function(t){var e=t.v,r=t.kx,n=t.hand,o=t.name,a="☗☖"[e]+(void 0===o?U[e]:o)+"　"+function(t){return T.values.map((function(e){return{kind:e,amount:t[e]}})).filter((function(t){var e=t.kind,r=t.amount;return(0,T.isRawKind)(e)&&r>0})).reverse().map((function(t){var e=t.kind,r=t.amount;return(0,T.kindToString)(e,!0)+function(t){if(t<=1)return"";var e="";return t>10&&(e+="十",t-=10),e+F.charAt(t-1)}(r)})).join("")||"なし"}(n),u=-a.length*r*9/14,l=a.length>13?13/a.length:1;return i.createElement("g",{transform:0==e?"translate("+11.35*r+","+9.7*r+") scale(1,"+l+")":"translate("+.65*r+","+.8*r+") scale(-1,"+-l+")"},Array.from({length:a.length-1},(function(t,e){return e})).map((function(t){return i.createElement("text",{key:t,fontSize:9*r/14,fill:O,textAnchor:"middle",x:0,y:-t*r*9/14},a.charAt(a.length-t-1))})),i.createElement("polygon",{points:"0,".concat(u," ").concat(.23*r,",").concat(u+.1*r," ").concat(.3*r,",").concat(u+.6*r," ").concat(-.3*r,",").concat(u+.6*r," ").concat(-.23*r,",").concat(u+.1*r),fill:0!=e?"none":O,stroke:O,strokeWidth:r/25}))};function P(t,e){return!!e&&t===8-(e.x-1)+9*(e.y-1)}const R=(0,i.forwardRef)((function(t,e){var r=t.width,n=t.height,o=t.state,a=t.latestMoveTo,u=t.children,c=t.players,f=t.style,s=void 0===f?{}:f;if(!o)return null;var h=25,d=Math.floor(31.25),p=Math.floor(18.75),v=[];return Array.from({length:9},(function(t,e){return e})).forEach((function(t){t&&(v.push(i.createElement("line",{key:t+"h",x1:t*h+d+.25,x2:t*h+d+.25,y1:p+.25,y2:p+225+.25,strokeWidth:.5,stroke:O})),v.push(i.createElement("line",{key:t+"v",y1:t*h+p+.25,y2:t*h+p+.25,x1:d+.25,x2:d+225+.25,strokeWidth:.5,stroke:O}))),v.push(i.createElement("text",{key:t+"h-num",x:t*h+d+12.5,y:p-h/6,fontSize:10,fill:O,textAnchor:"middle"},"１２３４５６７８９".charAt(8-t))),v.push(i.createElement("text",{key:t+"v-num",x:d+225+8.75,y:t*h+p+15,fontSize:10,fill:O,textAnchor:"middle"},F.charAt(t)))})),i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"kifuforjs-lite",style:Object.assign({aspectRatio:"".concat(r," / ").concat(n),fontFamily:"serif",userSelect:"none"},s),viewBox:"0 0 "+r+" "+n,ref:e},i.createElement("g",null,i.createElement("rect",{x:d,y:p,width:226,height:226,fill:"none",stroke:O,strokeWidth:2}),v),i.createElement("g",null,Array.from({length:81},(function(t,e){return e})).map((function(t){var e,r=[],n=o.board[8-t%9][Math.floor(t/9)];if(!("kind"in n)||!("color"in n))return null;var u=t%9*h+d+12.5+.25,c=Math.floor(t/9)*h+p+12.5+.25,f=(0,l.ZO)(n.kind),s={};return 2===f.length?(f=f[1],r.push(i.createElement("text",{key:"成",dy:-2.25,fill:O,fontSize:20.5,textAnchor:"middle",style:Object.assign({},P(t,a)?{fontFamily:"sans-serif",fontWeight:"bold"}:{})},"成")),s.dy=18.25,e="translate(".concat(u,",").concat(c,") scale(").concat(n.color===l.Il.White?"-1,-0.5":"1,0.5",")")):(s.dy=8,e="translate(".concat(u,",").concat(c,")").concat(n.color===l.Il.White?" scale(-1,-1)":"")),P(t,a)&&(s.style={fontWeight:"bold"},s.fontFamily="sans-serif"),r.push(i.createElement("text",Object.assign({key:t,fill:O,textAnchor:"middle",fontSize:20.5},s),f)),i.createElement("g",{key:t,transform:e},r)}))),i.createElement(M,{v:0,kx:h,hand:o.hands[0],name:null==c?void 0:c[0]}),i.createElement(M,{v:1,kx:h,hand:o.hands[1],name:null==c?void 0:c[1]}),u)}));var N=r(6062),H=r.n(N),G=r(4036),L=r.n(G),Y=r(6793),_=r.n(Y),B=r(7892),W=r.n(B),q=r(1173),Z=r.n(q),D=r(2464),z=r.n(D),J=r(8382),V={};V.styleTagTransform=z(),V.setAttributes=W(),V.insert=_().bind(null,"head"),V.domAPI=L(),V.insertStyleElement=Z(),H()(J.Z,V),J.Z&&J.Z.locals&&J.Z.locals;const $=(0,o.Pi)((function(t){var e=t.kifuStore,r=t.rows,n=void 0===r?10:r,o=t.style,a=e.player;return i.createElement("textarea",{key:e.player.tesuu,rows:n,className:"kifuforjs-comment",disabled:!0,value:e.errors.join("\n")||a.getComments().join("\n"),"aria-label":"局面コメント",style:o})}));function Q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==rt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==rt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===rt(o)?o:String(o)),n)}var o}function X(t,e){return X=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},X(t,e)}function tt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function et(t){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},et(t)}function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}var nt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&X(t,e)}(u,t);var e,r,n,o,a=(n=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=et(n);if(o){var r=et(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===rt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tt(t)}(this,t)});function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(e=a.call(this,t)).onChange=e.onChange.bind(tt(e)),e}return e=u,r=[{key:"render",value:function(){var t,e=this.props.kifuStore.player,r=e.tesuu<e.getMaxTesuu()?e.getReadableKifu(e.tesuu+1):null,n=e.getReadableForkKifu();return t=n.length>0?[i.createElement("option",{key:r,value:"top"},r)].concat(n.map((function(t,e){return i.createElement("option",{key:t,value:e},t)}))):i.createElement("option",{value:"top"},"変化なし"),this.props.kifuStore.hasFork&&i.createElement("select",{value:"top",onChange:this.onChange,disabled:0===n.length,"data-testid":"forklist","aria-label":"分岐"},t)}},{key:"onChange",value:function(t){this.props.kifuStore.player.forkAndForward(t.target.value)}}],r&&Q(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(i.Component);const ot=nt=function(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"===("undefined"==typeof Reflect?"undefined":rt(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a}([o.Pi],nt);function it(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==at(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==at(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===at(o)?o:String(o)),n)}var o}function at(t){return at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},at(t)}var ut="kifuforjs",lt=function(){function t(){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.hapticFeedback=!0,"undefined"!=typeof localStorage)try{var e=JSON.parse(localStorage.getItem(ut));return void(e&&(this.hapticFeedback=e.hapticFeedback))}catch(t){}}var e,r,o;return e=t,o=[{key:"get",value:function(){return this.instance||(this.instance=new t),this.instance}}],(r=[{key:"persist",value:function(){"undefined"!=typeof localStorage&&localStorage.setItem(ut,JSON.stringify((0,n.ZN)(this)))}}])&&it(e.prototype,r),o&&it(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();!function(t,e,r,n){var o,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"===("undefined"==typeof Reflect?"undefined":at(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(i<3?o(a):i>3?o(e,r,a):o(e,r))||a);i>3&&a&&Object.defineProperty(e,r,a)}([n.LO],lt.prototype,"hapticFeedback",void 0);var ct=lt.get();(0,n.EH)((function(){ct.persist()}));var ft=r(9553),st=r.n(ft);function ht(t){var e=t.filePath,r=!!e;return i.createElement("button",{style:{background:"none",border:"none",padding:0,fontSize:"inherit"},"aria-disabled":!r,onClick:function(){return r?open(e):alert("棋譜ファイル読み込み以外の方式のためダウンロードできません。（要望次第では今後対応予定です）")}},i.createElement("svg",{fill:"currentColor",style:{filter:"drop-shadow(2px 2px 2px rgba(0,0,0, 0.2))",opacity:.5},xmlns:"http://www.w3.org/2000/svg",height:48,viewBox:"0 -960 960 960",width:48},r?i.createElement("path",{d:"M480-313 287-506l43-43 120 120v-371h60v371l120-120 43 43-193 193ZM220-160q-24 0-42-18t-18-42v-143h60v143h520v-143h60v143q0 24-18 42t-42 18H220Z"}):i.createElement("path",{d:"m813-61-99-99H220q-24 0-42-18t-18-42v-143h60v143h434L520-354l-40 41-193-193 41-40L61-813l43-43 752 752-43 43ZM606-439l-43-44 67-66 43 43-67 67Zm-96-97-60-60v-204h60v264Zm290 294-60-60v-61h60v121Z"})),"Download Kifu")}const dt=function(t){var e=t.kifuStore,r=t.userSetting;return!e.staticOptions&&i.createElement("button",{style:{background:"none",border:"none",padding:0,fontSize:"inherit"},onClick:function(){(r.hapticFeedback=!r.hapticFeedback)&&navigator.vibrate(1)}},r.hapticFeedback?i.createElement("svg",{fill:"currentColor",style:{filter:"drop-shadow(2px 2px 2px rgba(0,0,0, 0.2))",opacity:.5},xmlns:"http://www.w3.org/2000/svg",height:48,viewBox:"0 -960 960 960",width:48},i.createElement("path",{d:"M0-365v-230h60v230H0Zm120 88v-406h60v406h-60Zm780-88v-230h60v230h-60Zm-120 88v-406h60v406h-60ZM300-120q-24.75 0-42.375-17.625T240-180v-600q0-24.75 17.625-42.375T300-840h360q24.75 0 42.375 17.625T720-780v600q0 24.75-17.625 42.375T660-120H300Zm0-60h360v-600H300v600Zm0 0v-600 600Z"})):i.createElement("svg",{fill:"currentColor",style:{filter:"drop-shadow(2px 2px 2px rgba(0,0,0, 0.2))",opacity:.5},xmlns:"http://www.w3.org/2000/svg",height:48,viewBox:"0 -960 960 960",width:48},i.createElement("path",{d:"M280-453h400v-60H280v60ZM480-80q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 31.5-156t86-127Q252-817 325-848.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 82-31.5 155T763-197.5q-54 54.5-127 86T480-80Zm0-60q142 0 241-99.5T820-480q0-142-99-241t-241-99q-141 0-240.5 99T140-480q0 141 99.5 240.5T480-140Zm0-340Z"})),i.createElement("div",null,"Haptic feedback?"))},pt=function(t){var e=t.style,r=void 0===e?{}:e;return i.createElement("div",{style:Object.assign({display:"inline-flex",flexDirection:"column"},r)},i.createElement("div",{style:{marginTop:"8px",fontSize:"40px",lineHeight:"22px",display:"inline-block",fontFamily:"Baskerville, serif"}},"Kifu",i.createElement("span",{style:{fontSize:"smaller"}}," for "),"JS"),i.createElement("div",{style:{fontSize:10,marginLeft:4}},"by na2hiro"))};function vt(){return i.createElement(i.Fragment,null,i.createElement("div",{style:{lineHeight:"50px",fontSize:"20px"}},"License"),i.createElement("div",{style:{clear:"left",overflowY:"auto",fontFamily:"monospace",lineBreak:"anywhere",margin:"0 16px",height:"calc(100% - 50px)",display:"flex",flexDirection:"column",justifyContent:"space-evenly"}},i.createElement("div",{style:{fontSize:"large"}},i.createElement("div",null,"This software,"),i.createElement("a",{href:"https://kifu-for-js.81.la",target:"_blank"},i.createElement(pt,{style:{margin:"5px 0"}}),i.createElement("svg",{fill:"currentColor",style:{verticalAlign:"baseline"},xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 -960 960 960",width:"24"},i.createElement("path",{d:"M212.309-140.001q-30.308 0-51.308-21t-21-51.308v-535.382q0-30.308 21-51.308t51.308-21h252.305V-760H212.309q-4.616 0-8.463 3.846-3.846 3.847-3.846 8.463v535.382q0 4.616 3.846 8.463 3.847 3.846 8.463 3.846h535.382q4.616 0 8.463-3.846 3.846-3.847 3.846-8.463v-252.305h59.999v252.305q0 30.308-21 51.308t-51.308 21H212.309Zm176.46-206.615-42.153-42.153L717.847-760H560v-59.999h259.999V-560H760v-157.847L388.769-346.616Z"}))),i.createElement("div",null,"is distributed under the MIT License.")),i.createElement("div",null,i.createElement("div",null,"Special thanks to:"),i.createElement("div",null,i.createElement("a",{href:"http://maasa.g2.xrea.com/shogizumen/",target:"_blank"},"shogizumen.js")," ","by maasa under MIT License"),i.createElement("div",null,i.createElement("a",{href:"https://fonts.google.com/icons",target:"_blank"},"Material Symbols")," ","by Google under Apache License 2.0"))))}const mt=function(t){var e=t.openSubPage;return i.createElement("button",{style:{background:"none",border:"none",padding:0,fontSize:"inherit"},onClick:function(){e(i.createElement(vt,null))}},i.createElement("svg",{fill:"currentColor",style:{filter:"drop-shadow(2px 2px 2px rgba(0,0,0, 0.2))",opacity:.5},xmlns:"http://www.w3.org/2000/svg",height:48,viewBox:"0 -960 960 960",width:48},i.createElement("path",{d:"M160-80q-33 0-56.5-23.5T80-160v-440q0-33 23.5-56.5T160-680h200v-120q0-33 23.5-56.5T440-880h80q33 0 56.5 23.5T600-800v120h200q33 0 56.5 23.5T880-600v440q0 33-23.5 56.5T800-80H160Zm0-80h640v-440H600q0 33-23.5 56.5T520-520h-80q-33 0-56.5-23.5T360-600H160v440Zm80-80h240v-18q0-17-9.5-31.5T444-312q-20-9-40.5-13.5T360-330q-23 0-43.5 4.5T276-312q-17 8-26.5 22.5T240-258v18Zm320-60h160v-60H560v60Zm-200-60q25 0 42.5-17.5T420-420q0-25-17.5-42.5T360-480q-25 0-42.5 17.5T300-420q0 25 17.5 42.5T360-360Zm200-60h160v-60H560v60ZM440-600h80v-200h-80v200Zm40 220Z"})),i.createElement("div",null,"License"))};function yt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var gt=(0,i.forwardRef)((function(t,e){var r,n,o=t.onClose,a=t.kifuStore,u=lt.get(),l=(r=(0,i.useState)(null),n=2,function(t){if(Array.isArray(t))return t}(r)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],l=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);l=!0);}catch(t){c=!0,o=t}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(r,n)||function(t,e){if(t){if("string"==typeof t)return yt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?yt(t,e):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=l[0],f=l[1];return i.createElement("div",{style:{display:"flex",flexDirection:"column",height:"100%",boxSizing:"border-box",background:"rgba(127, 127, 127, 0.5)",backdropFilter:"blur(5px)",borderRadius:2,position:"relative"},ref:e,onClick:function(t){return t.stopPropagation()}},i.createElement("button",{onClick:o,"aria-label":"Close",style:{position:"absolute",top:10,right:10,background:"none",border:"none",padding:0,display:c?"none":"initial"}},i.createElement("svg",{fill:"currentColor",style:{opacity:.5},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",height:"30",width:"30"},i.createElement("path",{d:"m252.615-217.232-35.383-35.383L444.616-480 217.232-707.385l35.383-35.383L480-515.384l227.385-227.384 35.383 35.383L515.384-480l227.384 227.385-35.383 35.383L480-444.616 252.615-217.232Z"}))),i.createElement(pt,{style:Object.assign({margin:"20px auto"},c?{display:"none"}:{})}),i.createElement("div",{style:{display:c?"none":"grid",gridTemplateColumns:"repeat(3, 1fr)",alignContent:"center",gap:"4px",fontSize:"9px",textAlign:"center",flexGrow:1,margin:"20px"}},i.createElement(dt,{kifuStore:a,userSetting:u}),i.createElement(ht,{filePath:a.filePath}),i.createElement(mt,{openSubPage:f})),i.createElement("div",{style:{alignSelf:"end",margin:"15px",display:c?"none":"initial"}},i.createElement("a",{href:"https://kifu-for-js.81.la",target:"_blank",style:{color:"currentcolor",textDecoration:"underline"}},"公式サイトを開く",i.createElement("svg",{fill:"currentColor",style:{verticalAlign:"bottom"},xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 -960 960 960",width:"24"},i.createElement("path",{d:"M212.309-140.001q-30.308 0-51.308-21t-21-51.308v-535.382q0-30.308 21-51.308t51.308-21h252.305V-760H212.309q-4.616 0-8.463 3.846-3.846 3.847-3.846 8.463v535.382q0 4.616 3.846 8.463 3.847 3.846 8.463 3.846h535.382q4.616 0 8.463-3.846 3.846-3.847 3.846-8.463v-252.305h59.999v252.305q0 30.308-21 51.308t-51.308 21H212.309Zm176.46-206.615-42.153-42.153L717.847-760H560v-59.999h259.999V-560H760v-157.847L388.769-346.616Z"})))),c&&i.createElement(st(),{focusTrapOptions:{clickOutsideDeactivates:!0}},i.createElement("div",{style:{flexGrow:1,position:"relative"}},i.createElement("button",{onClick:function(){f(null)},"aria-label":"Go back",style:{float:"left",margin:"10px",background:"none",border:"none",padding:0}},i.createElement("svg",{fill:"currentColor",style:{opacity:.5},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",height:"30",width:"30"},i.createElement("path",{d:"m275.845-454.873 239.744 239.488L480-180.001 180.001-480 480-779.999l35.589 35.384-239.744 239.488h504.154v50.254H275.845Z"}))),c)))}));function kt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],l=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);l=!0);}catch(t){c=!0,o=t}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return bt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?bt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}(0,o.Pi)(gt);const xt=(0,i.forwardRef)((function(t,e){var r=t.width,n=t.height,o=t.kifuStore,a=kt((0,i.useState)(!1),2),u=a[0],l=a[1],c=kt((0,i.useState)(!1),2),f=c[0],s=c[1];(0,i.useEffect)((function(){if("current"in e&&e.current){var t=function(){l(!0)};e.current.addEventListener("mouseenter",t),e.current.addEventListener("focusin",t);var r=function(){l(!1)};e.current.addEventListener("mouseleave",r),e.current.addEventListener("focusout",r);var n=function(){l(!0)};return e.current.addEventListener("touchstart",n),function(){var o,i,a,u,l;null===(o=e.current)||void 0===o||o.removeEventListener("mouseenter",t),null===(i=e.current)||void 0===i||i.removeEventListener("focusin",t),null===(a=e.current)||void 0===a||a.removeEventListener("mouseleave",r),null===(u=e.current)||void 0===u||u.removeEventListener("focusout",r),null===(l=e.current)||void 0===l||l.removeEventListener("touchstart",n)}}}),[e.current]),(0,i.useEffect)((function(){var t=function(t){var r;"current"in e&&(null===(r=e.current)||void 0===r?void 0:r.contains(t.target))||s(!1)};document.body.addEventListener("click",t);var r=function(t){var r;"current"in e&&(null===(r=e.current)||void 0===r?void 0:r.contains(t.target))||l(!1)};return document.body.addEventListener("touchstart",r),function(){document.body.removeEventListener("click",t),document.body.removeEventListener("touchstart",r)}}),[e.current]);var h=(0,i.useCallback)((function(){u&&s(!0)}),[u]);return i.createElement(i.Fragment,null,i.createElement("g",null,i.createElement("rect",{fillOpacity:0,x:9,y:232,width:15,height:15,onClick:h}),i.createElement("foreignObject",{x:7,y:230,width:19,height:19},i.createElement("button",{onClick:h,style:{background:"none",border:"none",padding:0}},i.createElement("svg",{x:7,y:230,width:19,height:19,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -960 960 960",fill:"currentColor",style:{opacity:u?.5:0,transition:"opacity 0.5s ease"}},i.createElement("path",{d:"m384.694-100.001-14.231-119.846q-13.077-6.385-30.462-16.077-17.385-9.693-29.693-18.77l-110.846 46.692L104.156-373l94.615-71.769q-.385-7.923-.962-17.423-.577-9.5-.577-17.423 0-7.539.577-16.847.577-9.308.962-18.769L104.156-587l95.306-164.229 110.461 46.308q13.462-9.462 29.885-18.962 16.424-9.501 30.27-16.27l14.616-119.846h190.612l14.231 120.231q15 7.538 30.078 16.269 15.077 8.731 28.923 18.578l112-46.308L855.844-587l-95.153 72.922q1.154 8.693 1.346 17.616.192 8.923.192 16.462 0 7.154-.384 16.077-.385 8.923-.77 18.77L855.46-373l-95.307 164.998-111.615-47.077q-13.846 9.847-29.308 18.962-15.462 9.116-29.693 15.885l-14.231 120.231H384.694Zm93.767-257q50.923 0 86.961-36.038Q601.46-429.078 601.46-480t-36.038-86.961q-36.038-36.038-86.961-36.038-50.537 0-86.768 36.038-36.23 36.039-36.23 86.961t36.23 86.961q36.231 36.038 86.768 36.038Zm0-63.999q-24 0-41.5-17.5t-17.5-41.5q0-24 17.5-41.5t41.5-17.5q24 0 41.5 17.5t17.5 41.5q0 24-17.5 41.5t-41.5 17.5ZM481-480Zm-41 316h79.615L532-269.154q28.615-8 54.461-23.231 25.846-15.23 49.385-38.384L733.231-289l40.384-66-85.769-65.385q5-15.538 6.808-29.961 1.807-14.423 1.807-29.654 0-13.615-1.807-27.154-1.808-13.538-5.808-30.692L775.385-605 735-671l-98.539 42.385q-21.076-21.462-49.115-37.923-28.039-16.462-54.731-23.308L520-796h-80.385l-12.23 105.769q-28.616 7.231-54.539 22.154-25.923 14.923-49.461 38.462L226-671l-40.385 66L270-539.615q-4 15.23-6 30.615-2 15.385-2 29.385 0 13.615 2 28.115 2 14.5 5.615 30.115l-84 66.385L226-289l97-41q22.769 22.385 48.692 37.308 25.923 14.923 55.308 22.923L440-164Z"}))))),i.createElement("foreignObject",{x:"0",y:"0",width:r,height:n,style:{transform:"scale(".concat(f?1:0,")"),opacity:f?1:0,display:f?"block":"none",transition:"transform 0.16s ease, opacity 0.16s ease"}},f&&i.createElement(st(),{focusTrapOptions:{clickOutsideDeactivates:!0}},i.createElement(gt,{onClose:function(){return s(!1)},kifuStore:o}))))}));function wt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Et(t){return t?"string"==typeof t||"number"==typeof t||"boolean"==typeof t?f(String(t)):Array.isArray(t)?t.map(Et).join("\n\n"):"props"in t?Et(t.props.children):"":t}const At=(0,o.Pi)((function(t){var e,r,n=t.kifuStore,o=t.children,a=t.style,u=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}(t,["kifuStore","children","style"]),l=(e=(0,i.useState)((function(){if(n)return Object.keys(u).length>0&&n.setOptions(u),n;var t=Et(o);return new y(Object.assign({kifu:t},u))})),r=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],l=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);l=!0);}catch(t){c=!0,o=t}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(e,r)||function(t,e){if(t){if("string"==typeof t)return wt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?wt(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=l[0],f=l[1],s=lt.get();!function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=(0,i.useRef)(!1);(0,i.useEffect)((function(){r.current?e&&navigator.vibrate(1):r.current=!0}),[t])}(c.player.tesuu,s.hapticFeedback),(0,i.useEffect)((function(){n&&f(n)}),[n]);var h=c.getLatestMoveTo(),d=!!c.staticOptions,p=(0,i.useRef)(null),v=250+(d?0:150);return i.createElement(R,{state:c.player.getState(),latestMoveTo:h,players:[c.player.kifu.header.先手,c.player.kifu.header.後手],width:300,height:v,style:Object.assign(Object.assign({},null===c.maxWidth?{}:{maxWidth:c.maxWidth}),a),ref:p},!d&&i.createElement(i.Fragment,null,i.createElement("rect",{fillOpacity:0,x:0,y:0,width:150,height:250,onClick:function(){return c.player.backward()}}),i.createElement("rect",{fillOpacity:0,x:150,y:0,width:150,height:250,onClick:function(){return c.player.forward()}}),i.createElement("foreignObject",{x:8,y:254,width:284,height:138},i.createElement("div",{style:{display:"grid",height:"100%",gap:"1px",gridAutoRows:"1fr"}},i.createElement("div",{style:{display:"flex",justifyContent:"space-between",height:"100%",gap:"1px"}},i.createElement("button",{onClick:function(){return c.player.backward()},disabled:0===c.player.tesuu,style:{minWidth:"70px",fontSize:"15px"}},"◀"),i.createElement(S,{player:c.player,style:{fontSize:"x-small"}}),i.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"1px"}},i.createElement("button",{onClick:function(){return c.player.forward()},style:{minWidth:"70px",fontSize:"15px",flexGrow:1},disabled:c.player.tesuu===c.player.currentStream.length-1},"▶"),i.createElement(ot,{kifuStore:c}))),i.createElement($,{kifuStore:c,rows:5,style:{fontSize:"small",resize:"none",backgroundColor:"inherit"}})))),i.createElement(xt,{width:300,height:v,kifuStore:c,ref:p}))}));function Kt(t){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kt(t)}function It(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==Kt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==Kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===Kt(o)?o:String(o)),n)}var o}r(2356);var St=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.kifuStoreMap=new WeakMap,this.awaitingMap=new WeakMap}var e,r;return e=t,(r=[{key:"register",value:function(t,e){this.kifuStoreMap.set(t,e),this.awaitingMap.has(t)&&(this.awaitingMap.get(t).forEach((function(t){return t(e)})),this.awaitingMap.delete(t))}},{key:"getKifuStore",value:function(t){var e=this;return this.kifuStoreMap.has(t)?Promise.resolve(this.kifuStoreMap.get(t)):new Promise((function(r){e.awaitingMap.get(t)||e.awaitingMap.set(t,[]),e.awaitingMap.get(t).push(r)}))}}])&&It(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}());function Ct(t){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ct(t)}var jt={autorun:n.EH,when:n.gx,reaction:n.U5},Ft={observer:o.Pi},Ot=At,Tt=y;function Ut(t,e,r){var n;return"object"===Ct(e)?(r=e,n=void 0):(n=e,r=r||{}),r.kifu=t,Pt(n,r)}function Mt(t,e,r){var n;return"string"==typeof t?("object"===Ct(e)?(r=e,n=void 0):(n=e,r=r||{}),r.src=t):(r=t,n=e),Pt(n,r)}function Pt(t,e){return new Promise((function(r){t||(t="kifuforjs_"+Math.random().toString(36).slice(2),document.write("<div id='"+t+"'></div>")),c((function(){var n=document.getElementById(t);if(!n)throw new Error("Container ".concat(t," not found"));var o=Rt(e,n);St.register(n,o),r(o)}))}))}function Rt(t,e){var r=new Tt(t);return(0,a.render)(i.createElement(Ot,{kifuStore:r}),e),r}function Nt(t){return St.getKifuStore(t)}"undefined"!=typeof document&&c((function(){for(var t=0,e=Array.from(document.getElementsByTagName("script"));t<e.length;t++){var r=e[t];if("text/kifu"===r.type&&!r.dataset.loaded)try{var n=document.createElement("ins");r.insertAdjacentElement("afterend",n),r.dataset.loaded="true";var o=Rt((a=void 0,a=(i=r).dataset.forkpointers?JSON.parse(i.dataset.forkpointers):void 0,{forkPointers:Array.isArray(a)&&a.every((function(t){return Array.isArray(t)&&2===t.length}))?a:void 0,kifu:f(i.textContent),ply:i.dataset.ply?parseInt(i.dataset.ply,10):void 0,src:i.dataset.src,static:function(){if("static"in i.dataset){var t=i.dataset.staticLast;if("hidden"===t)return{last:"hidden"};var e=t?JSON.parse(t):void 0;return Array.isArray(e)&&2===e.length&&e.every((function(t){return"number"==typeof t}))?{last:e}:{}}}()}),n);St.register(r,o)}catch(t){console.error(t,r)}}var i,a}))},8382:(t,e,r)=>{"use strict";r.d(e,{Z:()=>u});var n=r(9601),o=r.n(n),i=r(2609),a=r.n(i)()(o());a.push([t.id,".kifuforjs{width:570px;display:flex;flex-direction:column;background-color:#fff}.kifuforjs-wrapper{background-color:#fff}.kifuforjs--responsive{width:inherit;min-width:570px;max-width:900px;margin:auto}.kifuforjs-columns{display:flex;align-items:stretch}.kifuforjs-column{flex:1 1 0;display:flex;flex-direction:column}.kifuforjs-info{overflow-y:scroll;font-size:small;margin-bottom:2px}.kifuforjs-info dl{margin-top:0;margin-bottom:0;text-align:left}.kifuforjs-info dt{font-weight:bold;clear:both;float:left;margin-right:3px;background-color:#eee}.kifuforjs-info dd{margin-left:20px}.kifuforjs-leftcontrol{display:flex;flex-direction:column;margin-top:1px}.kifuforjs-leftcontrol>*{margin-top:1px}.kifuforjs-pieceinhand{position:relative;flex:0 0 50%}.kifuforjs-pieceinhand div{display:inline-block}.kifuforjs-pieceinhand--fu{flex:0 0 100%}.kifuforjs-board{margin:2px;border-collapse:collapse;align-self:center}.kifuforjs-board th{white-space:nowrap;text-align:center;vertical-align:middle;font-weight:bold}.kifuforjs-cell{border:1px #000 solid;background-color:#fdd775;padding:0}.kifuforjs-cell--lastto{background-color:#f90}.kifuforjs-halfofcolumn{flex:1 1 0;display:flex;flex-direction:column}.kifuforjs-hand-head{flex:0;text-align:center;background-color:silver}.kifuforjs-hand-body{flex:100%;background-color:#eee;display:flex;flex-wrap:wrap;align-content:flex-start;padding:2px 0}.kifuforjs-hand--reverse .kifuforjs-hand-body{flex-direction:row-reverse;flex-wrap:wrap-reverse}.kifuforjs-hand--reverse{flex-direction:column-reverse}.kifuforjs-control{display:flex;justify-content:center;margin:2px 0;white-space:nowrap}.kifuforjs-control button,.kifuforjs-control input{height:30px;width:55px;font-size:18px;text-align:center;vertical-align:bottom}.kifuforjs-control button div,.kifuforjs-control input div{height:100%;display:flex;align-items:center;justify-content:center}@media(min-width: 700px){.kifuforjs--responsive .kifuforjs-control button,.kifuforjs--responsive .kifuforjs-control input{height:35px;width:65px;font-size:22px}}@media(min-width: 864px){.kifuforjs--responsive .kifuforjs-control button,.kifuforjs--responsive .kifuforjs-control input{height:40px;width:80px;font-size:26px}}.kifuforjs-control-tools{font-size:15px}.kifuforjs .kifuforjs-comment{color:#000}.kifuforjs .kifuforjs-dragPreview{z-index:100}.kifuforjs-cell,.kifuforjs-cell img,.kifuforjs-pieceinhand img,.kifuforjs-pieceinhand,.kifuforjs-dragPreview{padding:0;border-spacing:0;width:32px;height:36px;vertical-align:middle}@media(min-width: 700px){.kifuforjs--responsive .kifuforjs-cell,.kifuforjs--responsive .kifuforjs-cell img,.kifuforjs--responsive .kifuforjs-pieceinhand img,.kifuforjs--responsive .kifuforjs-pieceinhand,.kifuforjs--responsive .kifuforjs-dragPreview{width:40px;height:45px}}@media(min-width: 864px){.kifuforjs--responsive .kifuforjs-cell,.kifuforjs--responsive .kifuforjs-cell img,.kifuforjs--responsive .kifuforjs-pieceinhand img,.kifuforjs--responsive .kifuforjs-pieceinhand,.kifuforjs--responsive .kifuforjs-dragPreview{width:48px;height:54px}}.kifuforjs-kifulist{position:relative;flex-grow:1;overflow-y:scroll;overflow-x:auto;border:1px #767676 solid;border-radius:2px;font-size:small;cursor:default}.kifuforjs-kifulist-inner{position:absolute;display:flex;flex-direction:column;align-items:stretch;width:100%}.kifuforjs-kifulist [role=option]{padding:0 2px}.kifuforjs-kifulist [aria-selected=true]{background-color:rgba(106,106,106,.35)}.kifuforjs-kifulist:focus .kifuforjs-kifulist [aria-selected=true]{background-color:#99c8ff}@media(max-aspect-ratio: 2/3),(max-width: 570px){.kifuforjs--responsive{min-width:320px}.kifuforjs--responsive .kifuforjs-columns{flex-direction:column}.kifuforjs--responsive .kifuforjs-column{flex-basis:initial;flex-direction:row;height:102px}}@media(max-aspect-ratio: 2/3)and (min-width: 400px),(max-width: 570px)and (min-width: 400px){.kifuforjs--responsive .kifuforjs-column{height:120px}}@media(max-aspect-ratio: 2/3)and (min-width: 480px),(max-width: 570px)and (min-width: 480px){.kifuforjs--responsive .kifuforjs-column{height:138px}}@media(max-aspect-ratio: 2/3),(max-width: 570px){.kifuforjs--responsive .kifuforjs-pieceinhand{flex:0 0 25%}.kifuforjs--responsive .kifuforjs-pieceinhand--fu{flex:0 0 50%}}@media(max-aspect-ratio: 2/3),(max-width: 570px){.kifuforjs--responsive .kifuforjs-board{margin:4px}}@media(max-aspect-ratio: 2/3),(max-width: 570px){.kifuforjs--responsive .kifuforjs-hand{flex-grow:2}}@media(max-aspect-ratio: 2/3),(max-width: 570px){.kifuforjs--responsive .kifuforjs-info{margin-bottom:0;margin-left:2px}}@media(max-aspect-ratio: 2/3),(max-width: 570px){.kifuforjs--responsive .kifuforjs-leftcontrol{margin-top:0;margin-right:2px}.kifuforjs--responsive .kifuforjs-leftcontrol>*:first-child{margin-top:0}}@media(max-aspect-ratio: 2/3),(max-width: 570px){.kifuforjs--responsive .kifuforjs-control-mainbutton{flex-grow:1}}@media(max-aspect-ratio: 2/3),(max-width: 570px){.kifuforjs--responsive .kifuforjs-cell,.kifuforjs--responsive .kifuforjs-cell img,.kifuforjs--responsive .kifuforjs-pieceinhand img,.kifuforjs--responsive .kifuforjs-pieceinhand,.kifuforjs--responsive .kifuforjs-dragPreview{padding:0;border-spacing:0;width:32px;height:36px;vertical-align:middle}}@media(max-aspect-ratio: 2/3)and (min-width: 400px),(max-width: 570px)and (min-width: 400px){.kifuforjs--responsive .kifuforjs-cell,.kifuforjs--responsive .kifuforjs-cell img,.kifuforjs--responsive .kifuforjs-pieceinhand img,.kifuforjs--responsive .kifuforjs-pieceinhand,.kifuforjs--responsive .kifuforjs-dragPreview{width:40px;height:45px}}@media(max-aspect-ratio: 2/3)and (min-width: 480px),(max-width: 570px)and (min-width: 480px){.kifuforjs--responsive .kifuforjs-cell,.kifuforjs--responsive .kifuforjs-cell img,.kifuforjs--responsive .kifuforjs-pieceinhand img,.kifuforjs--responsive .kifuforjs-pieceinhand,.kifuforjs--responsive .kifuforjs-dragPreview{width:48px;height:54px}}",""]);const u=a},9618:t=>{(()=>{"use strict";var e={396:t=>{function e(t,r,n,o){this.message=t,this.expected=r,this.found=n,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}!function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(e,Error),e.buildMessage=function(t,e){var r={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?i(t.parts[e][0])+"-"+i(t.parts[e][1]):i(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}return"Expected "+function(t){var e,n,o,i=new Array(t.length);for(e=0;e<t.length;e++)i[e]=(o=t[e],r[o.type](o));if(i.sort(),i.length>0){for(e=1,n=1;e<i.length;e++)i[e-1]!==i[e]&&(i[n]=i[e],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(e)+" found."},t.exports={SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var n,o,i,a,u={},l={kifu:Zt},c=Zt,f=function(t,e,r){var n={header:t.header,initial:e,moves:r};return t&&t.players&&(t.players[0]&&(n.header["先手"]=t.players[0]),t.players[1]&&(n.header["後手"]=t.players[1])),n},s="V2",h=Yt("V2",!1),d=".1",p=Yt(".1",!1),v=".2",m=Yt(".2",!1),y=function(t,e){return{players:t,header:e}},g=function(t){for(var e,r={},n=0;n<t.length;n++)r[(e=t[n].k,{EVENT:"棋戦",SITE:"場所",START_TIME:"開始日時",END_TIME:"終了日時",TIME_LIMIT:"持ち時間"}[e]||e)]=t[n].v;return r},k="$",b=Yt("$",!1),x=/^[^:]/,w=_t([":"],!0,!1),E=":",A=Yt(":",!1),K=function(t,e){return{k:t.join(""),v:e.join("")}},I=function(t,e,r){var n={header:{},initial:e,moves:r};return t&&(t[0]&&(n.header["先手"]=t[0]),t[1]&&(n.header["後手"]=t[1])),n},S="N+",C=Yt("N+",!1),j=function(t){return t},F="N-",O=Yt("N-",!1),T=function(t,e){return e},U=function(t,e){return[t?t.join(""):null,e?e.join(""):null]},M="",P=function(){return"NO"},R=function(t,e,r){"NO"==t?t=e:t.data.hands=e.data.hands;var n,o=t.data.hands.indexOf("AL_TO_REPLACE");if(o>=0){var i={FU:18,KY:4,KE:4,GI:4,KI:4,KA:2,HI:2};for(var a in t.data.hands[1-o])i[a]-=t.data.hands[1-o][a];for(var u=0;u<t.data.board.length;u++)for(var l=0;l<t.data.board[u].length;l++){var c=t.data.board[u][l];c.kind&&"OU"!=c.kind&&i[(n=c.kind,{TO:"FU",NY:"KY",NK:"KE",NG:"GI",UM:"KA",RY:"HI"}[n]||n)]--}t.data.hands[o]=i}return t.data.color=r,t},N="PI",H=Yt("PI",!1),G=function(t){for(var e={preset:"OTHER",data:{board:[[{color:1,kind:"KY"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KY"}],[{color:1,kind:"KE"},{color:1,kind:"KA"},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{color:0,kind:"HI"},{color:0,kind:"KE"}],[{color:1,kind:"GI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"GI"}],[{color:1,kind:"KI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KI"}],[{color:1,kind:"OU"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"OU"}],[{color:1,kind:"KI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KI"}],[{color:1,kind:"GI"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"GI"}],[{color:1,kind:"KE"},{color:1,kind:"HI"},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{color:0,kind:"KA"},{color:0,kind:"KE"}],[{color:1,kind:"KY"},{},{color:1,kind:"FU"},{},{},{},{color:0,kind:"FU"},{},{color:0,kind:"KY"}]]}},r=0;r<t.length;r++)e.data.board[t[r].xy.x-1][t[r].xy.y-1]={};return e},L=function(t){for(var e=[],r=0;r<9;r++){for(var n=[],o=0;o<9;o++)n.push(t[o][8-r]);e.push(n)}return{preset:"OTHER",data:{board:e}}},Y="P",_=Yt("P",!1),B=/^[1-9]/,W=_t([["1","9"]],!1,!1),q=function(t){return t},Z=function(t,e){return{color:t,kind:e}},D=" * ",z=Yt(" * ",!1),J=function(){return{}},V=function(t){for(var e=[],r=[{FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0},{FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0}],n=0;n<9;n++){for(var o=[],i=0;i<9;i++)o.push({});e.push(o)}t:for(n=0;n<t.length;n++)for(i=0;i<t[n].pieces.length;i++){var a=t[n].pieces[i];if(0==a.xy.x){if("AL"==a.piece){r[t[n].teban]="AL_TO_REPLACE";break t}r[t[n].teban][a.piece]++}else e[a.xy.x-1][a.xy.y-1]={color:t[n].teban,kind:a.piece}}return{preset:"OTHER",data:{board:e,hands:r}}},$=function(t,e){return{teban:t,pieces:e}},Q=function(t,e){return e.unshift(t),e},X=function(t){return t.length>0?{comments:t}:{}},tt=function(t,e,r,n){var o={};const i=e.concat(n);return i.length>0&&(o.comments=i),r&&(o.time=r),t.special?o.special=t.special:o.move=t,o},et=function(t,e,r){var n={to:e,piece:r};return 0!=t.x&&(n.from=t),n},rt="%",nt=Yt("%",!1),ot=/^[\-+_A-Z]/,it=_t(["-","+","_",["A","Z"]],!1,!1),at=function(t){return{special:t.join("")}},ut="+",lt=Yt("+",!1),ct=function(){return 0},ft="-",st=Yt("-",!1),ht=function(){return 1},dt="'",pt=Yt("'",!1),vt=function(t){return t.join("")},mt="T",yt=Yt("T",!1),gt=/^[0-9]/,kt=_t([["0","9"]],!1,!1),bt=function(t){return{now:(e=parseInt(t.join("")),r=e%60,{m:(e-r)/60,s:r})};var e,r},xt=function(t,e){return{x:parseInt(t),y:parseInt(e)}},wt=/^[A-Z]/,Et=_t([["A","Z"]],!1,!1),At=function(t,e){return t+e},Kt=function(t,e){return{xy:t,piece:e}},It="\r",St=Yt("\r",!1),Ct="\n",jt=Yt("\n",!1),Ft=" ",Ot=Yt(" ",!1),Tt=",",Ut=Yt(",",!1),Mt=/^[^\r\n]/,Pt=_t(["\r","\n"],!0,!1),Rt=0,Nt=[{line:1,column:1}],Ht=0,Gt=[],Lt=0;if("startRule"in r){if(!(r.startRule in l))throw new Error("Can't start parsing from rule \""+r.startRule+'".');c=l[r.startRule]}function Yt(t,e){return{type:"literal",text:t,ignoreCase:e}}function _t(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Bt(e){var r,n=Nt[e];if(n)return n;for(r=e-1;!Nt[r];)r--;for(n={line:(n=Nt[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Nt[e]=n,n}function Wt(t,e){var r=Bt(t),n=Bt(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function qt(t){Rt<Ht||(Rt>Ht&&(Ht=Rt,Gt=[]),Gt.push(t))}function Zt(){var e;return(e=function(){var e,r,n,o,i;return e=Rt,r=function(){var e,r,n,o,i;for(e=Rt,r=[],n=re();n!==u;)r.push(n),n=re();return r!==u?(t.substr(Rt,2)===s?(n=s,Rt+=2):(n=u,0===Lt&&qt(h)),n!==u?(t.substr(Rt,2)===d?(o=d,Rt+=2):(o=u,0===Lt&&qt(p)),o===u&&(t.substr(Rt,2)===v?(o=v,Rt+=2):(o=u,0===Lt&&qt(m))),o===u&&(o=null),o!==u&&(i=ae())!==u?e=r=[r,n,o,i]:(Rt=e,e=u)):(Rt=e,e=u)):(Rt=e,e=u),e}(),r!==u?(n=function(){var t,e,r;return t=Rt,(e=zt())===u&&(e=null),e!==u?(r=function(){var t,e;for(t=[],e=Dt();e!==u;)t.push(e),e=Dt();return t!==u&&(t=g(t)),t}(),r!==u?t=e=y(e,r):(Rt=t,t=u)):(Rt=t,t=u),t}(),n===u&&(n=null),n!==u&&(o=Jt())!==u?((i=Xt())===u&&(i=null),i!==u?e=r=f(n,o,i):(Rt=e,e=u)):(Rt=e,e=u)):(Rt=e,e=u),e}())===u&&(e=function(){var t,e,r,n;return t=Rt,(e=zt())===u&&(e=null),e!==u?((r=Jt())===u&&(r=null),r!==u&&(n=Xt())!==u?t=e=I(e,r,n):(Rt=t,t=u)):(Rt=t,t=u),t}()),e}function Dt(){var e,r,n,o,i,a,l;for(e=Rt,r=[],n=re();n!==u;)r.push(n),n=re();if(r!==u)if(36===t.charCodeAt(Rt)?(n=k,Rt++):(n=u,0===Lt&&qt(b)),n!==u){if(o=[],x.test(t.charAt(Rt))?(i=t.charAt(Rt),Rt++):(i=u,0===Lt&&qt(w)),i!==u)for(;i!==u;)o.push(i),x.test(t.charAt(Rt))?(i=t.charAt(Rt),Rt++):(i=u,0===Lt&&qt(w));else o=u;if(o!==u)if(58===t.charCodeAt(Rt)?(i=E,Rt++):(i=u,0===Lt&&qt(A)),i!==u){for(a=[],l=ue();l!==u;)a.push(l),l=ue();a!==u&&(l=ae())!==u?e=r=K(o,a):(Rt=e,e=u)}else Rt=e,e=u;else Rt=e,e=u}else Rt=e,e=u;else Rt=e,e=u;return e}function zt(){var e,r,n,o,i,a,l,c;for(e=Rt,r=[],n=re();n!==u;)r.push(n),n=re();if(r!==u){if(n=Rt,t.substr(Rt,2)===S?(o=S,Rt+=2):(o=u,0===Lt&&qt(C)),o!==u){for(i=[],a=ue();a!==u;)i.push(a),a=ue();i!==u&&(a=ae())!==u?n=o=j(i):(Rt=n,n=u)}else Rt=n,n=u;if(n===u&&(n=null),n!==u){for(o=[],i=re();i!==u;)o.push(i),i=re();if(o!==u){if(i=Rt,t.substr(Rt,2)===F?(a=F,Rt+=2):(a=u,0===Lt&&qt(O)),a!==u){for(l=[],c=ue();c!==u;)l.push(c),c=ue();l!==u&&(c=ae())!==u?i=a=T(n,l):(Rt=i,i=u)}else Rt=i,i=u;i===u&&(i=null),i!==u?e=r=U(n,i):(Rt=e,e=u)}else Rt=e,e=u}else Rt=e,e=u}else Rt=e,e=u;return e}function Jt(){var e,r,n,o,i,a;for(e=Rt,r=[],n=re();n!==u;)r.push(n),n=re();if(r!==u)if(n=function(){var e,r,n,o;if(e=Rt,t.substr(Rt,2)===N?(r=N,Rt+=2):(r=u,0===Lt&&qt(H)),r!==u){for(n=[],o=ie();o!==u;)n.push(o),o=ie();n!==u&&(o=ae())!==u?e=r=G(n):(Rt=e,e=u)}else Rt=e,e=u;return e}(),n===u&&(n=function(){var t,e;if(t=[],(e=Vt())!==u)for(;e!==u;)t.push(e),e=Vt();else t=u;return t!==u&&(t=L(t)),t}(),n===u&&(n=Rt,(o=M)!==u&&(o=P()),n=o)),n!==u)if(o=function(){var t,e;for(t=[],e=Qt();e!==u;)t.push(e),e=Qt();return t!==u&&(t=V(t)),t}(),o!==u){for(i=[],a=re();a!==u;)i.push(a),a=re();i!==u&&(a=ee())!==u&&ae()!==u?e=r=R(n,o,a):(Rt=e,e=u)}else Rt=e,e=u;else Rt=e,e=u;else Rt=e,e=u;return e}function Vt(){var e,r,n,o,i;if(e=Rt,80===t.charCodeAt(Rt)?(r=Y,Rt++):(r=u,0===Lt&&qt(_)),r!==u)if(B.test(t.charAt(Rt))?(n=t.charAt(Rt),Rt++):(n=u,0===Lt&&qt(W)),n!==u){if(o=[],(i=$t())!==u)for(;i!==u;)o.push(i),i=$t();else o=u;o!==u&&(i=ae())!==u?e=r=q(o):(Rt=e,e=u)}else Rt=e,e=u;else Rt=e,e=u;return e}function $t(){var e,r,n;return e=Rt,(r=ee())!==u&&(n=oe())!==u?e=r=Z(r,n):(Rt=e,e=u),e===u&&(e=Rt,t.substr(Rt,3)===D?(r=D,Rt+=3):(r=u,0===Lt&&qt(z)),r!==u&&(r=J()),e=r),e}function Qt(){var e,r,n,o,i;if(e=Rt,80===t.charCodeAt(Rt)?(r=Y,Rt++):(r=u,0===Lt&&qt(_)),r!==u)if((n=ee())!==u){for(o=[],i=ie();i!==u;)o.push(i),i=ie();o!==u&&(i=ae())!==u?e=r=$(n,o):(Rt=e,e=u)}else Rt=e,e=u;else Rt=e,e=u;return e}function Xt(){var t,e,r,n,o;if(t=Rt,e=function(){var t,e;for(t=[],e=re();e!==u;)t.push(e),e=re();return t!==u&&(t=X(t)),t}(),e!==u){for(r=[],n=te();n!==u;)r.push(n),n=te();if(r!==u){for(n=[],o=re();o!==u;)n.push(o),o=re();n!==u?t=e=Q(e,r):(Rt=t,t=u)}else Rt=t,t=u}else Rt=t,t=u;return t}function te(){var e,r,n,o,i,a;if(e=Rt,r=function(){var t,e,r,n;return t=Rt,ee()!==u&&(e=ne())!==u&&(r=ne())!==u&&(n=oe())!==u&&ae()!==u?t=et(e,r,n):(Rt=t,t=u),t}(),r===u&&(r=function(){var e,r,n,o;if(e=Rt,37===t.charCodeAt(Rt)?(r=rt,Rt++):(r=u,0===Lt&&qt(nt)),r!==u){if(n=[],ot.test(t.charAt(Rt))?(o=t.charAt(Rt),Rt++):(o=u,0===Lt&&qt(it)),o!==u)for(;o!==u;)n.push(o),ot.test(t.charAt(Rt))?(o=t.charAt(Rt),Rt++):(o=u,0===Lt&&qt(it));else n=u;n!==u&&(o=ae())!==u?e=r=at(n):(Rt=e,e=u)}else Rt=e,e=u;return e}()),r!==u){for(n=[],o=re();o!==u;)n.push(o),o=re();if(n!==u)if(o=function(){var e,r,n,o;if(e=Rt,84===t.charCodeAt(Rt)?(r=mt,Rt++):(r=u,0===Lt&&qt(yt)),r!==u){for(n=[],gt.test(t.charAt(Rt))?(o=t.charAt(Rt),Rt++):(o=u,0===Lt&&qt(kt));o!==u;)n.push(o),gt.test(t.charAt(Rt))?(o=t.charAt(Rt),Rt++):(o=u,0===Lt&&qt(kt));n!==u&&(o=ae())!==u?e=r=bt(n):(Rt=e,e=u)}else Rt=e,e=u;return e}(),o===u&&(o=null),o!==u){for(i=[],a=re();a!==u;)i.push(a),a=re();i!==u?e=r=tt(r,n,o,i):(Rt=e,e=u)}else Rt=e,e=u;else Rt=e,e=u}else Rt=e,e=u;return e}function ee(){var e,r;return e=Rt,43===t.charCodeAt(Rt)?(r=ut,Rt++):(r=u,0===Lt&&qt(lt)),r!==u&&(r=ct()),(e=r)===u&&(e=Rt,45===t.charCodeAt(Rt)?(r=ft,Rt++):(r=u,0===Lt&&qt(st)),r!==u&&(r=ht()),e=r),e}function re(){var e,r,n,o;if(e=Rt,39===t.charCodeAt(Rt)?(r=dt,Rt++):(r=u,0===Lt&&qt(pt)),r!==u){for(n=[],o=ue();o!==u;)n.push(o),o=ue();n!==u&&(o=ae())!==u?e=r=vt(n):(Rt=e,e=u)}else Rt=e,e=u;return e}function ne(){var e,r,n;return e=Rt,gt.test(t.charAt(Rt))?(r=t.charAt(Rt),Rt++):(r=u,0===Lt&&qt(kt)),r!==u?(gt.test(t.charAt(Rt))?(n=t.charAt(Rt),Rt++):(n=u,0===Lt&&qt(kt)),n!==u?e=r=xt(r,n):(Rt=e,e=u)):(Rt=e,e=u),e}function oe(){var e,r,n;return e=Rt,wt.test(t.charAt(Rt))?(r=t.charAt(Rt),Rt++):(r=u,0===Lt&&qt(Et)),r!==u?(wt.test(t.charAt(Rt))?(n=t.charAt(Rt),Rt++):(n=u,0===Lt&&qt(Et)),n!==u?e=r=At(r,n):(Rt=e,e=u)):(Rt=e,e=u),e}function ie(){var t,e,r;return t=Rt,(e=ne())!==u&&(r=oe())!==u?t=e=Kt(e,r):(Rt=t,t=u),t}function ae(){var e,r,n;if(e=Rt,13===t.charCodeAt(Rt)?(r=It,Rt++):(r=u,0===Lt&&qt(St)),r===u&&(r=null),r!==u?(10===t.charCodeAt(Rt)?(n=Ct,Rt++):(n=u,0===Lt&&qt(jt)),n!==u?e=r=[r,n]:(Rt=e,e=u)):(Rt=e,e=u),e===u){for(e=Rt,r=[],32===t.charCodeAt(Rt)?(n=Ft,Rt++):(n=u,0===Lt&&qt(Ot));n!==u;)r.push(n),32===t.charCodeAt(Rt)?(n=Ft,Rt++):(n=u,0===Lt&&qt(Ot));r!==u?(44===t.charCodeAt(Rt)?(n=Tt,Rt++):(n=u,0===Lt&&qt(Ut)),n!==u?e=r=[r,n]:(Rt=e,e=u)):(Rt=e,e=u)}return e}function ue(){var e;return Mt.test(t.charAt(Rt))?(e=t.charAt(Rt),Rt++):(e=u,0===Lt&&qt(Pt)),e}if((n=c())!==u&&Rt===t.length)return n;throw n!==u&&Rt<t.length&&qt({type:"end"}),o=Gt,i=Ht<t.length?t.charAt(Ht):null,a=Ht<t.length?Wt(Ht,Ht+1):Wt(Ht,Ht),new e(e.buildMessage(o,i),o,i,a)}}},526:t=>{function e(t,r,n,o){this.message=t,this.expected=r,this.found=n,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}!function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(e,Error),e.buildMessage=function(t,e){var r={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?i(t.parts[e][0])+"-"+i(t.parts[e][1]):i(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}return"Expected "+function(t){var e,n,o,i=new Array(t.length);for(e=0;e<t.length;e++)i[e]=(o=t[e],r[o.type](o));if(i.sort(),i.length>0){for(e=1,n=1;e<i.length;e++)i[e-1]!==i[e]&&(i[n]=i[e],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(e)+" found."},t.exports={SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var n,o,i,a,u={},l={kifu:Re},c=Re,f=function(t,e,r,n,o){for(var i={header:{},moves:n},a=0;a<t.length;a++)i.header[t[a].k]=t[a].v;for(a=0;a<r.length;a++)i.header[r[a].k]=r[a].v;if(e)i.initial=e;else if(i.header["手合割"]){var u=function(t){return{平手:"HIRATE",香落ち:"KY",右香落ち:"KY_R",角落ち:"KA",飛車落ち:"HI",飛香落ち:"HIKY",二枚落ち:"2",三枚落ち:"3",四枚落ち:"4",五枚落ち:"5",左五枚落ち:"5_L",六枚落ち:"6",左七枚落ち:"7_L",右七枚落ち:"7_R",八枚落ち:"8",十枚落ち:"10",その他:"OTHER"}[t.replace(/\s/g,"")]}(i.header["手合割"]);"OTHER"!=u&&(i.initial={preset:u})}i.initial&&i.initial.data&&(i.header["手番"]?(i.initial.data.color="下先".indexOf(i.header["手番"])>=0?0:1,delete i.header["手番"]):i.initial.data.color=0,i.initial.data.hands=[tr(i.header["先手の持駒"]||i.header["下手の持駒"]),tr(i.header["後手の持駒"]||i.header["上手の持駒"])],delete i.header["先手の持駒"],delete i.header["下手の持駒"],delete i.header["後手の持駒"],delete i.header["上手の持駒"]);var l=[{te:0,moves:n}];for(a=0;a<o.length;a++){for(var c=o[a],f=l.pop();f.te>=c.te;)f=l.pop();var s=f.moves[c.te-f.te];s.forks=s.forks||[],s.forks.push(c.moves),l.push(f),l.push(c)}return i},s=/^[^\uFF1A\r\n]/,h=Te(["：","\r","\n"],!0,!1),d="：",p=Oe("：",!1),v=function(t,e){return{k:t.join(""),v:e.join("")}},m=/^[\u5148\u5F8C\u4E0A\u4E0B]/,y=Te(["先","後","上","下"],!1,!1),g="手番",k=Oe("手番",!1),b=function(t){return{k:"手番",v:t}},x=" ",w=Oe(" ",!1),E="+",A=Oe("+",!1),K=function(t){for(var e=[],r=0;r<9;r++){for(var n=[],o=0;o<9;o++)n.push(t[o][8-r]);e.push(n)}return{preset:"OTHER",data:{board:e}}},I="|",S=Oe("|",!1),C=function(t){return t},j=function(t,e){return{color:t,kind:e}},F=" ・",O=Oe(" ・",!1),T=function(){return{}},U="^",M=Oe("^",!1),P=function(){return 0},R="v",N=Oe("v",!1),H="V",G=Oe("V",!1),L=function(){return 1},Y=function(t,e,r){return e.unshift(t),r&&!e[e.length-1].special&&e.push({special:r}),e},_=function(t){return 0==t.length?{}:{comments:t}},B=function(t,e){var r={move:t};return e.length>0&&(r.comments=e),r},W="&",q=Oe("&",!1),Z=/^[\u25B2\u25B3]/,D=Te(["▲","△"],!1,!1),z=function(t){return t},J="成",V=Oe("成",!1),$="不成",Q=Oe("不成",!1),X="打",tt=Oe("打",!1),et=function(t,e,r,n,o,i){var a={piece:e};if(t.same?a.same=!0:a.to=t,o&&(a.promote="成"==o),i)a.relative="H";else{var u=({左:"L",直:"C",右:"R"}[r]||"")+({上:"U",寄:"M",引:"D"}[n]||"");""!=u&&(a.relative=u)}return a},rt=function(t,e){return{x:t,y:e}},nt="同",ot=Oe("同",!1),it="　",at=Oe("　",!1),ut=function(){return{same:!0}},lt=/^[\u6B69\u9999\u6842\u9280\u91D1\u89D2\u98DB\u738B\u7389\u3068\u674F\u572D\u5168\u99AC\u7ADC\u9F8D]/,ct=Te(["歩","香","桂","銀","金","角","飛","王","玉","と","杏","圭","全","馬","竜","龍"],!1,!1),ft=function(t,e){return Xe((t||"")+e)},st=/^[\u5DE6\u76F4\u53F3]/,ht=Te(["左","直","右"],!1,!1),dt=/^[\u4E0A\u5BC4\u5F15]/,pt=Te(["上","寄","引"],!1,!1),vt=/^[\uFF11\uFF12\uFF13\uFF14\uFF15\uFF16\uFF17\uFF18\uFF19]/,mt=Te(["１","２","３","４","５","６","７","８","９"],!1,!1),yt=function(t){return"０１２３４５６７８９".indexOf(t)},gt=/^[\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D]/,kt=Te(["一","二","三","四","五","六","七","八","九"],!1,!1),bt=function(t){return"〇一二三四五六七八九".indexOf(t)},xt="*",wt=Oe("*",!1),Et=function(t){return t.join("")},At="まで",Kt=Oe("まで",!1),It=/^[0-9]/,St=Te([["0","9"]],!1,!1),Ct="手",jt=Oe("手",!1),Ft="で",Ot=Oe("で",!1),Tt="手の",Ut=Oe("手の",!1),Mt="勝ち",Pt=Oe("勝ち",!1),Rt=function(t){return"TORYO"},Nt="反則",Ht=Oe("反則",!1),Gt=function(t){return"ILLEGAL_ACTION"},Lt="負け",Yt=Oe("負け",!1),_t=function(t){return"ILLEGAL_MOVE"},Bt=function(t,e){return e},Wt="で時間切れにより",qt=Oe("で時間切れにより",!1),Zt="手の勝ち",Dt=Oe("手の勝ち",!1),zt=function(t){return"TIME_UP"},Jt="で中断",Vt=Oe("で中断",!1),$t=function(){return"CHUDAN"},Qt="で持将棋",Xt=Oe("で持将棋",!1),te=function(){return"JISHOGI"},ee="で千日手",re=Oe("で千日手",!1),ne=function(){return"SENNICHITE"},oe="詰",ie=Oe("詰",!1),ae="み",ue=Oe("み",!1),le=function(){return"TSUMI"},ce="で不詰",fe=Oe("で不詰",!1),se=function(){return"FUZUMI"},he=function(t){return t},de="変化：",pe=Oe("変化：",!1),ve=function(t,e){return{te:parseInt(t.join("")),moves:e.slice(1)}},me="#",ye=Oe("#",!1),ge="\t",ke=Oe("\t",!1),be="\n",xe=Oe("\n",!1),we="\r",Ee=Oe("\r",!1),Ae=/^[^\r\n]/,Ke=Te(["\r","\n"],!0,!1),Ie=0,Se=[{line:1,column:1}],Ce=0,je=[],Fe=0;if("startRule"in r){if(!(r.startRule in l))throw new Error("Can't start parsing from rule \""+r.startRule+'".');c=l[r.startRule]}function Oe(t,e){return{type:"literal",text:t,ignoreCase:e}}function Te(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Ue(e){var r,n=Se[e];if(n)return n;for(r=e-1;!Se[r];)r--;for(n={line:(n=Se[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Se[e]=n,n}function Me(t,e){var r=Ue(t),n=Ue(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function Pe(t){Ie<Ce||(Ie>Ce&&(Ce=Ie,je=[]),je.push(t))}function Re(){var e,r,n,o,i,a,l;for(e=Ie,r=[],n=Ne();n!==u;)r.push(n),n=Ne();if(r!==u)if(n=function(){var e,r,n,o,i,a,l,c;if(e=Ie,r=Ie,32===t.charCodeAt(Ie)?(n=x,Ie++):(n=u,0===Fe&&Pe(w)),n!==u){for(o=[],i=$e();i!==u;)o.push(i),i=$e();o!==u&&(i=De())!==u?r=n=[n,o,i]:(Ie=r,r=u)}else Ie=r,r=u;if(r===u&&(r=null),r!==u){if(n=Ie,43===t.charCodeAt(Ie)?(o=E,Ie++):(o=u,0===Fe&&Pe(A)),o!==u){for(i=[],a=$e();a!==u;)i.push(a),a=$e();i!==u&&(a=De())!==u?n=o=[o,i,a]:(Ie=n,n=u)}else Ie=n,n=u;if(n===u&&(n=null),n!==u){if(o=[],(i=He())!==u)for(;i!==u;)o.push(i),i=He();else o=u;if(o!==u){if(i=Ie,43===t.charCodeAt(Ie)?(a=E,Ie++):(a=u,0===Fe&&Pe(A)),a!==u){for(l=[],c=$e();c!==u;)l.push(c),c=$e();l!==u&&(c=De())!==u?i=a=[a,l,c]:(Ie=i,i=u)}else Ie=i,i=u;i===u&&(i=null),i!==u?e=r=K(o):(Ie=e,e=u)}else Ie=e,e=u}else Ie=e,e=u}else Ie=e,e=u;return e}(),n===u&&(n=null),n!==u){for(o=[],i=Ne();i!==u;)o.push(i),i=Ne();if(o!==u)if((i=Le())!==u){for(a=[],l=qe();l!==u;)a.push(l),l=qe();a!==u?e=r=f(r,n,o,i,a):(Ie=e,e=u)}else Ie=e,e=u;else Ie=e,e=u}else Ie=e,e=u;else Ie=e,e=u;return e}function Ne(){var e,r,n,o,i,a;if(e=Ie,r=[],s.test(t.charAt(Ie))?(n=t.charAt(Ie),Ie++):(n=u,0===Fe&&Pe(h)),n!==u)for(;n!==u;)r.push(n),s.test(t.charAt(Ie))?(n=t.charAt(Ie),Ie++):(n=u,0===Fe&&Pe(h));else r=u;if(r!==u)if(65306===t.charCodeAt(Ie)?(n=d,Ie++):(n=u,0===Fe&&Pe(p)),n!==u){for(o=[],i=$e();i!==u;)o.push(i),i=$e();if(o!==u){if(i=[],(a=De())!==u)for(;a!==u;)i.push(a),a=De();else i=u;i!==u?e=r=v(r,o):(Ie=e,e=u)}else Ie=e,e=u}else Ie=e,e=u;else Ie=e,e=u;return e===u&&(e=Ie,m.test(t.charAt(Ie))?(r=t.charAt(Ie),Ie++):(r=u,0===Fe&&Pe(y)),r!==u?(t.substr(Ie,2)===g?(n=g,Ie+=2):(n=u,0===Fe&&Pe(k)),n!==u&&(o=De())!==u?e=r=b(r):(Ie=e,e=u)):(Ie=e,e=u)),e}function He(){var e,r,n,o,i,a;if(e=Ie,124===t.charCodeAt(Ie)?(r=I,Ie++):(r=u,0===Fe&&Pe(S)),r!==u){if(n=[],(o=Ge())!==u)for(;o!==u;)n.push(o),o=Ge();else n=u;if(n!==u)if(124===t.charCodeAt(Ie)?(o=I,Ie++):(o=u,0===Fe&&Pe(S)),o!==u){if(i=[],(a=$e())!==u)for(;a!==u;)i.push(a),a=$e();else i=u;i!==u&&(a=De())!==u?e=r=C(n):(Ie=e,e=u)}else Ie=e,e=u;else Ie=e,e=u}else Ie=e,e=u;return e}function Ge(){var e,r,n;return e=Ie,r=function(){var e,r;return e=Ie,32===t.charCodeAt(Ie)?(r=x,Ie++):(r=u,0===Fe&&Pe(w)),r===u&&(43===t.charCodeAt(Ie)?(r=E,Ie++):(r=u,0===Fe&&Pe(A)),r===u&&(94===t.charCodeAt(Ie)?(r=U,Ie++):(r=u,0===Fe&&Pe(M)))),r!==u&&(r=P()),(e=r)===u&&(e=Ie,118===t.charCodeAt(Ie)?(r=R,Ie++):(r=u,0===Fe&&Pe(N)),r===u&&(86===t.charCodeAt(Ie)?(r=H,Ie++):(r=u,0===Fe&&Pe(G))),r!==u&&(r=L()),e=r),e}(),r!==u&&(n=Be())!==u?e=r=j(r,n):(Ie=e,e=u),e===u&&(e=Ie,t.substr(Ie,2)===F?(r=F,Ie+=2):(r=u,0===Fe&&Pe(O)),r!==u&&(r=T()),e=r),e}function Le(){var e,r,n,o;if(e=Ie,r=function(){var t,e,r;for(t=Ie,e=[],r=We();r!==u;)e.push(r),r=We();return e!==u?((r=_e())===u&&(r=null),r!==u?t=e=_(e):(Ie=t,t=u)):(Ie=t,t=u),t}(),r!==u){for(n=[],o=Ye();o!==u;)n.push(o),o=Ye();n!==u?(o=function(){var e,r,n,o,i,a,l,c,f,s,h,d;if(e=Ie,t.substr(Ie,2)===At?(r=At,Ie+=2):(r=u,0===Fe&&Pe(Kt)),r!==u){if(n=[],It.test(t.charAt(Ie))?(o=t.charAt(Ie),Ie++):(o=u,0===Fe&&Pe(St)),o!==u)for(;o!==u;)n.push(o),It.test(t.charAt(Ie))?(o=t.charAt(Ie),Ie++):(o=u,0===Fe&&Pe(St));else n=u;n!==u?(25163===t.charCodeAt(Ie)?(o=Ct,Ie++):(o=u,0===Fe&&Pe(jt)),o!==u?(i=Ie,12391===t.charCodeAt(Ie)?(a=Ft,Ie++):(a=u,0===Fe&&Pe(Ot)),a!==u&&(l=Ze())!==u?(t.substr(Ie,2)===Tt?(c=Tt,Ie+=2):(c=u,0===Fe&&Pe(Ut)),c!==u?(f=Ie,t.substr(Ie,2)===Mt?(s=Mt,Ie+=2):(s=u,0===Fe&&Pe(Pt)),s!==u&&(s=Rt(l)),(f=s)===u&&(f=Ie,t.substr(Ie,2)===Nt?(s=Nt,Ie+=2):(s=u,0===Fe&&Pe(Ht)),s!==u?(h=Ie,t.substr(Ie,2)===Mt?(d=Mt,Ie+=2):(d=u,0===Fe&&Pe(Pt)),d!==u&&(d=Gt(l)),(h=d)===u&&(h=Ie,t.substr(Ie,2)===Lt?(d=Lt,Ie+=2):(d=u,0===Fe&&Pe(Yt)),d!==u&&(d=_t(l)),h=d),h!==u?f=s=Bt(l,h):(Ie=f,f=u)):(Ie=f,f=u)),f!==u?i=a=Bt(l,f):(Ie=i,i=u)):(Ie=i,i=u)):(Ie=i,i=u),i===u&&(i=Ie,t.substr(Ie,8)===Wt?(a=Wt,Ie+=8):(a=u,0===Fe&&Pe(qt)),a!==u&&(l=Ze())!==u?(t.substr(Ie,4)===Zt?(c=Zt,Ie+=4):(c=u,0===Fe&&Pe(Dt)),c!==u?i=a=zt(l):(Ie=i,i=u)):(Ie=i,i=u),i===u&&(i=Ie,t.substr(Ie,3)===Jt?(a=Jt,Ie+=3):(a=u,0===Fe&&Pe(Vt)),a!==u&&(a=$t()),(i=a)===u&&(i=Ie,t.substr(Ie,4)===Qt?(a=Qt,Ie+=4):(a=u,0===Fe&&Pe(Xt)),a!==u&&(a=te()),(i=a)===u&&(i=Ie,t.substr(Ie,4)===ee?(a=ee,Ie+=4):(a=u,0===Fe&&Pe(re)),a!==u&&(a=ne()),(i=a)===u&&(i=Ie,12391===t.charCodeAt(Ie)?(a=Ft,Ie++):(a=u,0===Fe&&Pe(Ot)),a===u&&(a=null),a!==u?(35440===t.charCodeAt(Ie)?(l=oe,Ie++):(l=u,0===Fe&&Pe(ie)),l!==u?(12415===t.charCodeAt(Ie)?(c=ae,Ie++):(c=u,0===Fe&&Pe(ue)),c===u&&(c=null),c!==u?i=a=le():(Ie=i,i=u)):(Ie=i,i=u)):(Ie=i,i=u),i===u&&(i=Ie,t.substr(Ie,3)===ce?(a=ce,Ie+=3):(a=u,0===Fe&&Pe(fe)),a!==u&&(a=se()),i=a)))))),i!==u&&(a=De())!==u?e=r=he(i):(Ie=e,e=u)):(Ie=e,e=u)):(Ie=e,e=u)}else Ie=e,e=u;return e}(),o===u&&(o=null),o!==u?e=r=Y(r,n,o):(Ie=e,e=u)):(Ie=e,e=u)}else Ie=e,e=u;return e}function Ye(){var e,r,n,o,i,a;if(e=Ie,r=function(){var e,r,n,o,i;if(e=Ie,Z.test(t.charAt(Ie))?(r=t.charAt(Ie),Ie++):(r=u,0===Fe&&Pe(D)),r!==u)if(n=function(){var e,r,n,o,i,a,l;return e=Ie,r=function(){var e,r,n;return e=Ie,(r=function(){var e;return vt.test(t.charAt(Ie))?(e=t.charAt(Ie),Ie++):(e=u,0===Fe&&Pe(mt)),e!==u&&(e=yt(e)),e}())!==u?(n=function(){var e;return gt.test(t.charAt(Ie))?(e=t.charAt(Ie),Ie++):(e=u,0===Fe&&Pe(kt)),e!==u&&(e=bt(e)),e}(),n!==u?e=r=rt(r,n):(Ie=e,e=u)):(Ie=e,e=u),e===u&&(e=Ie,21516===t.charCodeAt(Ie)?(r=nt,Ie++):(r=u,0===Fe&&Pe(ot)),r!==u?(12288===t.charCodeAt(Ie)?(n=it,Ie++):(n=u,0===Fe&&Pe(at)),n===u&&(n=null),n!==u?e=r=ut():(Ie=e,e=u)):(Ie=e,e=u)),e}(),r!==u&&(n=Be())!==u?(o=function(){var e;return st.test(t.charAt(Ie))?(e=t.charAt(Ie),Ie++):(e=u,0===Fe&&Pe(ht)),e}(),o===u&&(o=null),o!==u?(i=function(){var e;return dt.test(t.charAt(Ie))?(e=t.charAt(Ie),Ie++):(e=u,0===Fe&&Pe(pt)),e}(),i===u&&(i=null),i!==u?(25104===t.charCodeAt(Ie)?(a=J,Ie++):(a=u,0===Fe&&Pe(V)),a===u&&(t.substr(Ie,2)===$?(a=$,Ie+=2):(a=u,0===Fe&&Pe(Q))),a===u&&(a=null),a!==u?(25171===t.charCodeAt(Ie)?(l=X,Ie++):(l=u,0===Fe&&Pe(tt)),l===u&&(l=null),l!==u?e=r=et(r,n,o,i,a,l):(Ie=e,e=u)):(Ie=e,e=u)):(Ie=e,e=u)):(Ie=e,e=u)):(Ie=e,e=u),e}(),n!==u){for(o=[],(i=De())===u&&(32===t.charCodeAt(Ie)?(i=x,Ie++):(i=u,0===Fe&&Pe(w)));i!==u;)o.push(i),(i=De())===u&&(32===t.charCodeAt(Ie)?(i=x,Ie++):(i=u,0===Fe&&Pe(w)));o!==u?e=r=z(n):(Ie=e,e=u)}else Ie=e,e=u;else Ie=e,e=u;return e}(),r!==u){for(n=[],o=We();o!==u;)n.push(o),o=We();if(n!==u)if((o=_e())===u&&(o=null),o!==u){for(i=[],(a=De())===u&&(32===t.charCodeAt(Ie)?(a=x,Ie++):(a=u,0===Fe&&Pe(w)));a!==u;)i.push(a),(a=De())===u&&(32===t.charCodeAt(Ie)?(a=x,Ie++):(a=u,0===Fe&&Pe(w)));i!==u?e=r=B(r,n):(Ie=e,e=u)}else Ie=e,e=u;else Ie=e,e=u}else Ie=e,e=u;return e}function _e(){var e,r,n,o;if(e=Ie,38===t.charCodeAt(Ie)?(r=W,Ie++):(r=u,0===Fe&&Pe(q)),r!==u){for(n=[],o=$e();o!==u;)n.push(o),o=$e();n!==u&&(o=De())!==u?e=r=[r,n,o]:(Ie=e,e=u)}else Ie=e,e=u;return e}function Be(){var e,r,n;return e=Ie,25104===t.charCodeAt(Ie)?(r=J,Ie++):(r=u,0===Fe&&Pe(V)),r===u&&(r=null),r!==u?(lt.test(t.charAt(Ie))?(n=t.charAt(Ie),Ie++):(n=u,0===Fe&&Pe(ct)),n!==u?e=r=ft(r,n):(Ie=e,e=u)):(Ie=e,e=u),e}function We(){var e,r,n,o;if(e=Ie,42===t.charCodeAt(Ie)?(r=xt,Ie++):(r=u,0===Fe&&Pe(wt)),r!==u){for(n=[],o=$e();o!==u;)n.push(o),o=$e();n!==u&&(o=De())!==u?e=r=Et(n):(Ie=e,e=u)}else Ie=e,e=u;return e}function qe(){var e,r,n,o,i,a;if(e=Ie,t.substr(Ie,3)===de?(r=de,Ie+=3):(r=u,0===Fe&&Pe(pe)),r!==u){for(n=[],32===t.charCodeAt(Ie)?(o=x,Ie++):(o=u,0===Fe&&Pe(w));o!==u;)n.push(o),32===t.charCodeAt(Ie)?(o=x,Ie++):(o=u,0===Fe&&Pe(w));if(n!==u){if(o=[],It.test(t.charAt(Ie))?(i=t.charAt(Ie),Ie++):(i=u,0===Fe&&Pe(St)),i!==u)for(;i!==u;)o.push(i),It.test(t.charAt(Ie))?(i=t.charAt(Ie),Ie++):(i=u,0===Fe&&Pe(St));else o=u;o!==u?(25163===t.charCodeAt(Ie)?(i=Ct,Ie++):(i=u,0===Fe&&Pe(jt)),i!==u&&De()!==u&&(a=Le())!==u?e=r=ve(o,a):(Ie=e,e=u)):(Ie=e,e=u)}else Ie=e,e=u}else Ie=e,e=u;return e}function Ze(){var e;return m.test(t.charAt(Ie))?(e=t.charAt(Ie),Ie++):(e=u,0===Fe&&Pe(y)),e}function De(){var t,e,r,n;if(t=Ie,e=[],(r=Ve())!==u)for(;r!==u;)e.push(r),r=Ve();else e=u;if(e!==u){for(r=[],n=ze();n!==u;)r.push(n),n=ze();r!==u?t=e=[e,r]:(Ie=t,t=u)}else Ie=t,t=u;return t}function ze(){var e,r,n,o;if(e=Ie,35===t.charCodeAt(Ie)?(r=me,Ie++):(r=u,0===Fe&&Pe(ye)),r!==u){for(n=[],o=$e();o!==u;)n.push(o),o=$e();n!==u&&(o=Ve())!==u?e=r=[r,n,o]:(Ie=e,e=u)}else Ie=e,e=u;return e}function Je(){var e;return 32===t.charCodeAt(Ie)?(e=x,Ie++):(e=u,0===Fe&&Pe(w)),e===u&&(9===t.charCodeAt(Ie)?(e=ge,Ie++):(e=u,0===Fe&&Pe(ke))),e}function Ve(){var e,r,n,o,i;for(e=Ie,r=[],n=Je();n!==u;)r.push(n),n=Je();return r!==u?(10===t.charCodeAt(Ie)?(n=be,Ie++):(n=u,0===Fe&&Pe(xe)),n===u&&(n=Ie,13===t.charCodeAt(Ie)?(o=we,Ie++):(o=u,0===Fe&&Pe(Ee)),o!==u?(10===t.charCodeAt(Ie)?(i=be,Ie++):(i=u,0===Fe&&Pe(xe)),i===u&&(i=null),i!==u?n=o=[o,i]:(Ie=n,n=u)):(Ie=n,n=u)),n!==u?e=r=[r,n]:(Ie=e,e=u)):(Ie=e,e=u),e}function $e(){var e;return Ae.test(t.charAt(Ie))?(e=t.charAt(Ie),Ie++):(e=u,0===Fe&&Pe(Ke)),e}function Qe(t){switch(t.length){case 1:return"〇一二三四五六七八九十".indexOf(t);case 2:return"〇一二三四五六七八九十".indexOf(t[1])+10;default:throw"21以上の数値に対応していません"}}function Xe(t){return"成"==t[0]?{香:"NY",桂:"NK",銀:"NG"}[t[1]]:{歩:"FU",香:"KY",桂:"KE",銀:"GI",金:"KI",角:"KA",飛:"HI",玉:"OU",王:"OU",と:"TO",杏:"NY",圭:"NK",全:"NG",馬:"UM",竜:"RY",龍:"RY"}[t]}function tr(t){var e=t.replace(/　$/,"").split("　"),r={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0};if(""==t)return r;for(var n=0;n<e.length;n++)r[Xe(e[n][0])]=1==e[n].length?1:Qe(e[n].slice(1));return r}if((n=c())!==u&&Ie===t.length)return n;throw n!==u&&Ie<t.length&&Pe({type:"end"}),o=je,i=Ce<t.length?t.charAt(Ce):null,a=Ce<t.length?Me(Ce,Ce+1):Me(Ce,Ce),new e(e.buildMessage(o,i),o,i,a)}}},382:t=>{function e(t,r,n,o){this.message=t,this.expected=r,this.found=n,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}!function(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}(e,Error),e.buildMessage=function(t,e){var r={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?i(t.parts[e][0])+"-"+i(t.parts[e][1]):i(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}return"Expected "+function(t){var e,n,o,i=new Array(t.length);for(e=0;e<t.length;e++)i[e]=(o=t[e],r[o.type](o));if(i.sort(),i.length>0){for(e=1,n=1;e<i.length;e++)i[e-1]!==i[e]&&(i[n]=i[e],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(e)+" found."},t.exports={SyntaxError:e,parse:function(t,r){r=void 0!==r?r:{};var n,o,i,a,u={},l={kifu:er},c=er,f=function(t,e,r,n,o){for(var i={header:{},moves:n},a=0;a<t.length;a++)t[a]&&(i.header[t[a].k]=t[a].v);for(a=0;a<r.length;a++)r[a]&&(i.header[r[a].k]=r[a].v);if(e)i.initial=e;else if(i.header["手合割"]){var u=function(t){return{平手:"HIRATE",香落ち:"KY",右香落ち:"KY_R",角落ち:"KA",飛車落ち:"HI",飛香落ち:"HIKY",二枚落ち:"2",三枚落ち:"3",四枚落ち:"4",五枚落ち:"5",左五枚落ち:"5_L",六枚落ち:"6",左七枚落ち:"7_L",右七枚落ち:"7_R",八枚落ち:"8",十枚落ち:"10",その他:"OTHER"}[t.replace(/\s/g,"")]}(i.header["手合割"]);"OTHER"!=u&&(i.initial={preset:u})}i.initial&&i.initial.data&&(i.header["手番"]?(i.initial.data.color="下先".indexOf(i.header["手番"])>=0?0:1,delete i.header["手番"]):i.initial.data.color=0,i.initial.data.hands=[xr(i.header["先手の持駒"]||i.header["下手の持駒"]),xr(i.header["後手の持駒"]||i.header["上手の持駒"])],delete i.header["先手の持駒"],delete i.header["下手の持駒"],delete i.header["後手の持駒"],delete i.header["上手の持駒"]);var l=[{te:0,moves:n}];for(a=0;a<o.length;a++){for(var c=o[a],f=l.pop();f.te>=c.te;)f=l.pop();var s=f.moves[c.te-f.te];s.forks=s.forks||[],s.forks.push(c.moves),l.push(f),l.push(c)}return i},s=/^[^\uFF1A\r\n]/,h=$e(["：","\r","\n"],!0,!1),d="：",p=Ve("：",!1),v=function(t,e){return{k:t.join(""),v:e.join("")}},m="手番",y=Ve("手番",!1),g=function(t){return{k:"手番",v:t}},k="盤面回転",b=Ve("盤面回転",!1),x=function(){return null},w=/^[\u5148\u5F8C\u4E0A\u4E0B]/,E=$e(["先","後","上","下"],!1,!1),A=" ",K=Ve(" ",!1),I="+",S=Ve("+",!1),C=function(t){for(var e=[],r=0;r<9;r++){for(var n=[],o=0;o<9;o++)n.push(t[o][8-r]);e.push(n)}return{preset:"OTHER",data:{board:e}}},j="|",F=Ve("|",!1),O=function(t){return t},T=function(t,e){return{color:t,kind:e}},U=" ・",M=Ve(" ・",!1),P=function(){return{}},R="^",N=Ve("^",!1),H=function(){return 0},G="v",L=Ve("v",!1),Y="V",_=Ve("V",!1),B=function(){return 1},W="手数----指手--",q=Ve("手数----指手--",!1),Z="-------消費時間--",D=Ve("-------消費時間--",!1),z=function(t,e){return e.unshift(t),e},J=function(t){return 0==t.length?{}:{comments:t}},V=function(t,e){var r={};return e.length>0&&(r.comments=e),"object"==typeof t.move?r.move=t.move:r.special={中断:"CHUDAN",封じ手:"CHUDAN",投了:"TORYO",持将棋:"JISHOGI",千日手:"SENNICHITE",詰み:"TSUMI",不詰:"FUZUMI",切れ負け:"TIME_UP",反則勝ち:"ILLEGAL_ACTION",反則負け:"ILLEGAL_MOVE"}[t.move],t.time&&(r.time=t.time),r},$="&",Q=Ve("&",!1),X=function(t,e){var r={piece:t.piece};return t.to?r.to=t.to:r.same=!0,t.promote&&(r.promote=!0),e&&(r.from=e),r},tt=/^[^\r\n ]/,et=$e(["\r","\n"," "],!0,!1),rt=function(t){return t.join("")},nt=function(t,e){return{move:t,time:e}},ot=/^[0-9]/,it=$e([["0","9"]],!1,!1),at="成",ut=Ve("成",!1),lt=function(t,e,r){return{to:t,piece:e,promote:!!r}},ct=function(t,e){return{x:t,y:e}},ft="同",st=Ve("同",!1),ht="　",dt=Ve("　",!1),pt=/^[\uFF11\uFF12\uFF13\uFF14\uFF15\uFF16\uFF17\uFF18\uFF19]/,vt=$e(["１","２","３","４","５","６","７","８","９"],!1,!1),mt=function(t){return"０１２３４５６７８９".indexOf(t)},yt=/^[\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D]/,gt=$e(["一","二","三","四","五","六","七","八","九"],!1,!1),kt=function(t){return"〇一二三四五六七八九".indexOf(t)},bt=/^[\u6B69\u9999\u6842\u9280\u91D1\u89D2\u98DB\u738B\u7389\u3068\u674F\u572D\u5168\u99AC\u7ADC\u9F8D]/,xt=$e(["歩","香","桂","銀","金","角","飛","王","玉","と","杏","圭","全","馬","竜","龍"],!1,!1),wt=function(t,e){return br((t||"")+e)},Et="打",At=Ve("打",!1),Kt="(",It=Ve("(",!1),St=/^[1-9]/,Ct=$e([["1","9"]],!1,!1),jt=")",Ft=Ve(")",!1),Ot=function(t,e){return{x:parseInt(t),y:parseInt(e)}},Tt="/",Ut=Ve("/",!1),Mt=function(t,e){return{now:t,total:e}},Pt=":",Rt=Ve(":",!1),Nt=function(t,e,r){return{h:gr(t),m:gr(e),s:gr(r)}},Ht=function(t,e){return{m:gr(t),s:gr(e)}},Gt="*",Lt=Ve("*",!1),Yt=function(t){return t.join("")},_t=function(t){return"&"+t.join("")},Bt="まで",Wt=Ve("まで",!1),qt="手",Zt=Ve("手",!1),Dt="で",zt=Ve("で",!1),Jt="手の",Vt=Ve("手の",!1),$t="勝ち",Qt=Ve("勝ち",!1),Xt=function(t){return"TORYO"},te="反則",ee=Ve("反則",!1),re=function(t){return"ILLEGAL_ACTION"},ne="負け",oe=Ve("負け",!1),ie=function(t){return"ILLEGAL_MOVE"},ae=function(t,e){return e},ue="で時間切れにより",le=Ve("で時間切れにより",!1),ce="手の勝ち",fe=Ve("手の勝ち",!1),se=function(t){return"TIME_UP"},he="で中断",de=Ve("で中断",!1),pe=function(){return"CHUDAN"},ve="で封じ手",me=Ve("で封じ手",!1),ye="で持将棋",ge=Ve("で持将棋",!1),ke=function(){return"JISHOGI"},be="で千日手",xe=Ve("で千日手",!1),we=function(){return"SENNICHITE"},Ee="詰",Ae=Ve("詰",!1),Ke="み",Ie=Ve("み",!1),Se=function(){return"TSUMI"},Ce="で不詰",je=Ve("で不詰",!1),Fe=function(){return"FUZUMI"},Oe=function(t){return t},Te="変化：",Ue=Ve("変化：",!1),Me=function(t,e){return{te:parseInt(t.join("")),moves:e.slice(1)}},Pe="#",Re=Ve("#",!1),Ne="\t",He=Ve("\t",!1),Ge="\n",Le=Ve("\n",!1),Ye="\r",_e=Ve("\r",!1),Be=/^[^\r\n]/,We=$e(["\r","\n"],!0,!1),qe=0,Ze=[{line:1,column:1}],De=0,ze=[],Je=0;if("startRule"in r){if(!(r.startRule in l))throw new Error("Can't start parsing from rule \""+r.startRule+'".');c=l[r.startRule]}function Ve(t,e){return{type:"literal",text:t,ignoreCase:e}}function $e(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function Qe(e){var r,n=Ze[e];if(n)return n;for(r=e-1;!Ze[r];)r--;for(n={line:(n=Ze[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Ze[e]=n,n}function Xe(t,e){var r=Qe(t),n=Qe(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function tr(t){qe<De||(qe>De&&(De=qe,ze=[]),ze.push(t))}function er(){var e,r,n,o,i,a,l,c,s;for(e=qe,r=[],n=pr();n!==u;)r.push(n),n=pr();if(r!==u){for(n=[],o=rr();o!==u;)n.push(o),o=rr();if(n!==u)if(o=function(){var e,r,n,o,i,a,l,c;if(e=qe,r=qe,32===t.charCodeAt(qe)?(n=A,qe++):(n=u,0===Je&&tr(K)),n!==u){for(o=[],i=yr();i!==u;)o.push(i),i=yr();o!==u&&(i=dr())!==u?r=n=[n,o,i]:(qe=r,r=u)}else qe=r,r=u;if(r===u&&(r=null),r!==u){if(n=qe,43===t.charCodeAt(qe)?(o=I,qe++):(o=u,0===Je&&tr(S)),o!==u){for(i=[],a=yr();a!==u;)i.push(a),a=yr();i!==u&&(a=dr())!==u?n=o=[o,i,a]:(qe=n,n=u)}else qe=n,n=u;if(n===u&&(n=null),n!==u){if(o=[],(i=or())!==u)for(;i!==u;)o.push(i),i=or();else o=u;if(o!==u){if(i=qe,43===t.charCodeAt(qe)?(a=I,qe++):(a=u,0===Je&&tr(S)),a!==u){for(l=[],c=yr();c!==u;)l.push(c),c=yr();l!==u&&(c=dr())!==u?i=a=[a,l,c]:(qe=i,i=u)}else qe=i,i=u;i===u&&(i=null),i!==u?e=r=C(o):(qe=e,e=u)}else qe=e,e=u}else qe=e,e=u}else qe=e,e=u;return e}(),o===u&&(o=null),o!==u){for(i=[],a=rr();a!==u;)i.push(a),a=rr();if(i!==u)if((a=ar())===u&&(a=null),a!==u)if((l=ur())!==u){for(c=[],s=hr();s!==u;)c.push(s),s=hr();c!==u?((s=dr())===u&&(s=null),s!==u?e=r=f(n,o,i,l,c):(qe=e,e=u)):(qe=e,e=u)}else qe=e,e=u;else qe=e,e=u;else qe=e,e=u}else qe=e,e=u;else qe=e,e=u}else qe=e,e=u;return e}function rr(){var e,r,n,o,i;if(e=qe,r=[],s.test(t.charAt(qe))?(n=t.charAt(qe),qe++):(n=u,0===Je&&tr(h)),n!==u)for(;n!==u;)r.push(n),s.test(t.charAt(qe))?(n=t.charAt(qe),qe++):(n=u,0===Je&&tr(h));else r=u;if(r!==u)if(65306===t.charCodeAt(qe)?(n=d,qe++):(n=u,0===Je&&tr(p)),n!==u){for(o=[],i=yr();i!==u;)o.push(i),i=yr();o!==u&&(i=dr())!==u?e=r=v(r,o):(qe=e,e=u)}else qe=e,e=u;else qe=e,e=u;return e===u&&(e=qe,(r=nr())!==u?(t.substr(qe,2)===m?(n=m,qe+=2):(n=u,0===Je&&tr(y)),n!==u&&(o=dr())!==u?e=r=g(r):(qe=e,e=u)):(qe=e,e=u),e===u&&(e=qe,t.substr(qe,4)===k?(r=k,qe+=4):(r=u,0===Je&&tr(b)),r!==u&&(n=dr())!==u?e=r=x():(qe=e,e=u))),e}function nr(){var e;return w.test(t.charAt(qe))?(e=t.charAt(qe),qe++):(e=u,0===Je&&tr(E)),e}function or(){var e,r,n,o,i,a;if(e=qe,124===t.charCodeAt(qe)?(r=j,qe++):(r=u,0===Je&&tr(F)),r!==u){if(n=[],(o=ir())!==u)for(;o!==u;)n.push(o),o=ir();else n=u;if(n!==u)if(124===t.charCodeAt(qe)?(o=j,qe++):(o=u,0===Je&&tr(F)),o!==u){if(i=[],(a=yr())!==u)for(;a!==u;)i.push(a),a=yr();else i=u;i!==u&&(a=dr())!==u?e=r=O(n):(qe=e,e=u)}else qe=e,e=u;else qe=e,e=u}else qe=e,e=u;return e}function ir(){var e,r,n;return e=qe,r=function(){var e,r;return e=qe,32===t.charCodeAt(qe)?(r=A,qe++):(r=u,0===Je&&tr(K)),r===u&&(43===t.charCodeAt(qe)?(r=I,qe++):(r=u,0===Je&&tr(S)),r===u&&(94===t.charCodeAt(qe)?(r=R,qe++):(r=u,0===Je&&tr(N)))),r!==u&&(r=H()),(e=r)===u&&(e=qe,118===t.charCodeAt(qe)?(r=G,qe++):(r=u,0===Je&&tr(L)),r===u&&(86===t.charCodeAt(qe)?(r=Y,qe++):(r=u,0===Je&&tr(_))),r!==u&&(r=B()),e=r),e}(),r!==u&&(n=fr())!==u?e=r=T(r,n):(qe=e,e=u),e===u&&(e=qe,t.substr(qe,2)===U?(r=U,qe+=2):(r=u,0===Je&&tr(M)),r!==u&&(r=P()),e=r),e}function ar(){var e,r,n,o;return e=qe,t.substr(qe,10)===W?(r=W,qe+=10):(r=u,0===Je&&tr(q)),r!==u?(t.substr(qe,13)===Z?(n=Z,qe+=13):(n=u,0===Je&&tr(D)),n===u&&(n=null),n!==u&&(o=dr())!==u?e=r=[r,n,o]:(qe=e,e=u)):(qe=e,e=u),e}function ur(){var e,r,n,o,i;if(e=qe,r=function(){var t,e,r;for(t=qe,e=[],r=sr();r!==u;)e.push(r),r=sr();return e!==u?((r=cr())===u&&(r=null),r!==u?t=e=J(e):(qe=t,t=u)):(qe=t,t=u),t}(),r!==u)if((n=ar())===u&&(n=null),n!==u){for(o=[],i=lr();i!==u;)o.push(i),i=lr();o!==u?(i=function(){var e,r,n,o,i,a,l,c,f,s,h,d;if(e=qe,t.substr(qe,2)===Bt?(r=Bt,qe+=2):(r=u,0===Je&&tr(Wt)),r!==u){if(n=[],ot.test(t.charAt(qe))?(o=t.charAt(qe),qe++):(o=u,0===Je&&tr(it)),o!==u)for(;o!==u;)n.push(o),ot.test(t.charAt(qe))?(o=t.charAt(qe),qe++):(o=u,0===Je&&tr(it));else n=u;n!==u?(25163===t.charCodeAt(qe)?(o=qt,qe++):(o=u,0===Je&&tr(Zt)),o!==u?(i=qe,12391===t.charCodeAt(qe)?(a=Dt,qe++):(a=u,0===Je&&tr(zt)),a!==u&&(l=nr())!==u?(t.substr(qe,2)===Jt?(c=Jt,qe+=2):(c=u,0===Je&&tr(Vt)),c!==u?(f=qe,t.substr(qe,2)===$t?(s=$t,qe+=2):(s=u,0===Je&&tr(Qt)),s!==u&&(s=Xt(l)),(f=s)===u&&(f=qe,t.substr(qe,2)===te?(s=te,qe+=2):(s=u,0===Je&&tr(ee)),s!==u?(h=qe,t.substr(qe,2)===$t?(d=$t,qe+=2):(d=u,0===Je&&tr(Qt)),d!==u&&(d=re(l)),(h=d)===u&&(h=qe,t.substr(qe,2)===ne?(d=ne,qe+=2):(d=u,0===Je&&tr(oe)),d!==u&&(d=ie(l)),h=d),h!==u?f=s=ae(l,h):(qe=f,f=u)):(qe=f,f=u)),f!==u?i=a=ae(l,f):(qe=i,i=u)):(qe=i,i=u)):(qe=i,i=u),i===u&&(i=qe,t.substr(qe,8)===ue?(a=ue,qe+=8):(a=u,0===Je&&tr(le)),a!==u&&(l=nr())!==u?(t.substr(qe,4)===ce?(c=ce,qe+=4):(c=u,0===Je&&tr(fe)),c!==u?i=a=se(l):(qe=i,i=u)):(qe=i,i=u),i===u&&(i=qe,t.substr(qe,3)===he?(a=he,qe+=3):(a=u,0===Je&&tr(de)),a!==u&&(a=pe()),(i=a)===u&&(i=qe,t.substr(qe,4)===ve?(a=ve,qe+=4):(a=u,0===Je&&tr(me)),a!==u&&(a=pe()),(i=a)===u&&(i=qe,t.substr(qe,4)===ye?(a=ye,qe+=4):(a=u,0===Je&&tr(ge)),a!==u&&(a=ke()),(i=a)===u&&(i=qe,t.substr(qe,4)===be?(a=be,qe+=4):(a=u,0===Je&&tr(xe)),a!==u&&(a=we()),(i=a)===u&&(i=qe,12391===t.charCodeAt(qe)?(a=Dt,qe++):(a=u,0===Je&&tr(zt)),a===u&&(a=null),a!==u?(35440===t.charCodeAt(qe)?(l=Ee,qe++):(l=u,0===Je&&tr(Ae)),l!==u?(12415===t.charCodeAt(qe)?(c=Ke,qe++):(c=u,0===Je&&tr(Ie)),c===u&&(c=null),c!==u?i=a=Se():(qe=i,i=u)):(qe=i,i=u)):(qe=i,i=u),i===u&&(i=qe,t.substr(qe,3)===Ce?(a=Ce,qe+=3):(a=u,0===Je&&tr(je)),a!==u&&(a=Fe()),i=a))))))),i!==u&&(a=dr())!==u?e=r=Oe(i):(qe=e,e=u)):(qe=e,e=u)):(qe=e,e=u)}else qe=e,e=u;return e}(),i===u&&(i=null),i!==u?e=r=z(r,o):(qe=e,e=u)):(qe=e,e=u)}else qe=e,e=u;else qe=e,e=u;return e}function lr(){var e,r,n,o;if(e=qe,r=function(){var e,r,n,o,i,a,l,c;for(e=qe,r=[],32===t.charCodeAt(qe)?(n=A,qe++):(n=u,0===Je&&tr(K));n!==u;)r.push(n),32===t.charCodeAt(qe)?(n=A,qe++):(n=u,0===Je&&tr(K));if(r!==u)if(n=function(){var e,r;if(e=[],ot.test(t.charAt(qe))?(r=t.charAt(qe),qe++):(r=u,0===Je&&tr(it)),r!==u)for(;r!==u;)e.push(r),ot.test(t.charAt(qe))?(r=t.charAt(qe),qe++):(r=u,0===Je&&tr(it));else e=u;return e}(),n!==u){for(o=[],32===t.charCodeAt(qe)?(i=A,qe++):(i=u,0===Je&&tr(K));i!==u;)o.push(i),32===t.charCodeAt(qe)?(i=A,qe++):(i=u,0===Je&&tr(K));if(o!==u){if(i=qe,a=function(){var e,r,n,o;return e=qe,r=function(){var e,r,n;return e=qe,(r=function(){var e;return pt.test(t.charAt(qe))?(e=t.charAt(qe),qe++):(e=u,0===Je&&tr(vt)),e!==u&&(e=mt(e)),e}())!==u?(n=function(){var e;return yt.test(t.charAt(qe))?(e=t.charAt(qe),qe++):(e=u,0===Je&&tr(gt)),e!==u&&(e=kt(e)),e}(),n!==u?e=r=ct(r,n):(qe=e,e=u)):(qe=e,e=u),e===u&&(e=qe,21516===t.charCodeAt(qe)?(r=ft,qe++):(r=u,0===Je&&tr(st)),r!==u?(12288===t.charCodeAt(qe)?(n=ht,qe++):(n=u,0===Je&&tr(dt)),n===u&&(n=null),n!==u?e=r=x():(qe=e,e=u)):(qe=e,e=u)),e}(),r!==u&&(n=fr())!==u?(25104===t.charCodeAt(qe)?(o=at,qe++):(o=u,0===Je&&tr(ut)),o===u&&(o=null),o!==u?e=r=lt(r,n,o):(qe=e,e=u)):(qe=e,e=u),e}(),a!==u?(l=function(){var e,r,n,o,i;return e=qe,25171===t.charCodeAt(qe)?(r=Et,qe++):(r=u,0===Je&&tr(At)),r!==u&&(r=x()),(e=r)===u&&(e=qe,40===t.charCodeAt(qe)?(r=Kt,qe++):(r=u,0===Je&&tr(It)),r!==u?(St.test(t.charAt(qe))?(n=t.charAt(qe),qe++):(n=u,0===Je&&tr(Ct)),n!==u?(St.test(t.charAt(qe))?(o=t.charAt(qe),qe++):(o=u,0===Je&&tr(Ct)),o!==u?(41===t.charCodeAt(qe)?(i=jt,qe++):(i=u,0===Je&&tr(Ft)),i!==u?e=r=Ot(n,o):(qe=e,e=u)):(qe=e,e=u)):(qe=e,e=u)):(qe=e,e=u)),e}(),l!==u?i=a=X(a,l):(qe=i,i=u)):(qe=i,i=u),i===u){for(i=qe,a=[],tt.test(t.charAt(qe))?(l=t.charAt(qe),qe++):(l=u,0===Je&&tr(et));l!==u;)a.push(l),tt.test(t.charAt(qe))?(l=t.charAt(qe),qe++):(l=u,0===Je&&tr(et));a!==u&&(a=rt(a)),i=a}if(i!==u){for(a=[],32===t.charCodeAt(qe)?(l=A,qe++):(l=u,0===Je&&tr(K));l!==u;)a.push(l),32===t.charCodeAt(qe)?(l=A,qe++):(l=u,0===Je&&tr(K));a!==u?(l=function(){var e,r,n,o,i,a,l,c,f;if(e=qe,40===t.charCodeAt(qe)?(r=Kt,qe++):(r=u,0===Je&&tr(It)),r!==u){for(n=[],32===t.charCodeAt(qe)?(o=A,qe++):(o=u,0===Je&&tr(K));o!==u;)n.push(o),32===t.charCodeAt(qe)?(o=A,qe++):(o=u,0===Je&&tr(K));if(n!==u)if(o=function(){var e,r,n,o,i;if(e=qe,r=[],ot.test(t.charAt(qe))?(n=t.charAt(qe),qe++):(n=u,0===Je&&tr(it)),n!==u)for(;n!==u;)r.push(n),ot.test(t.charAt(qe))?(n=t.charAt(qe),qe++):(n=u,0===Je&&tr(it));else r=u;if(r!==u)if(58===t.charCodeAt(qe)?(n=Pt,qe++):(n=u,0===Je&&tr(Rt)),n!==u){if(o=[],ot.test(t.charAt(qe))?(i=t.charAt(qe),qe++):(i=u,0===Je&&tr(it)),i!==u)for(;i!==u;)o.push(i),ot.test(t.charAt(qe))?(i=t.charAt(qe),qe++):(i=u,0===Je&&tr(it));else o=u;o!==u?e=r=Ht(r,o):(qe=e,e=u)}else qe=e,e=u;else qe=e,e=u;return e}(),o!==u){for(i=[],32===t.charCodeAt(qe)?(a=A,qe++):(a=u,0===Je&&tr(K));a!==u;)i.push(a),32===t.charCodeAt(qe)?(a=A,qe++):(a=u,0===Je&&tr(K));if(i!==u)if(47===t.charCodeAt(qe)?(a=Tt,qe++):(a=u,0===Je&&tr(Ut)),a!==u){for(l=[],32===t.charCodeAt(qe)?(c=A,qe++):(c=u,0===Je&&tr(K));c!==u;)l.push(c),32===t.charCodeAt(qe)?(c=A,qe++):(c=u,0===Je&&tr(K));l!==u?(c=function(){var e,r,n,o,i,a,l;if(e=qe,r=[],ot.test(t.charAt(qe))?(n=t.charAt(qe),qe++):(n=u,0===Je&&tr(it)),n!==u)for(;n!==u;)r.push(n),ot.test(t.charAt(qe))?(n=t.charAt(qe),qe++):(n=u,0===Je&&tr(it));else r=u;if(r!==u)if(58===t.charCodeAt(qe)?(n=Pt,qe++):(n=u,0===Je&&tr(Rt)),n!==u){if(o=[],ot.test(t.charAt(qe))?(i=t.charAt(qe),qe++):(i=u,0===Je&&tr(it)),i!==u)for(;i!==u;)o.push(i),ot.test(t.charAt(qe))?(i=t.charAt(qe),qe++):(i=u,0===Je&&tr(it));else o=u;if(o!==u)if(58===t.charCodeAt(qe)?(i=Pt,qe++):(i=u,0===Je&&tr(Rt)),i!==u){if(a=[],ot.test(t.charAt(qe))?(l=t.charAt(qe),qe++):(l=u,0===Je&&tr(it)),l!==u)for(;l!==u;)a.push(l),ot.test(t.charAt(qe))?(l=t.charAt(qe),qe++):(l=u,0===Je&&tr(it));else a=u;a!==u?e=r=Nt(r,o,a):(qe=e,e=u)}else qe=e,e=u;else qe=e,e=u}else qe=e,e=u;else qe=e,e=u;return e}(),c!==u?(41===t.charCodeAt(qe)?(f=jt,qe++):(f=u,0===Je&&tr(Ft)),f!==u?e=r=Mt(o,c):(qe=e,e=u)):(qe=e,e=u)):(qe=e,e=u)}else qe=e,e=u;else qe=e,e=u}else qe=e,e=u;else qe=e,e=u}else qe=e,e=u;return e}(),l===u&&(l=null),l!==u?(43===t.charCodeAt(qe)?(c=I,qe++):(c=u,0===Je&&tr(S)),c===u&&(c=null),c!==u&&dr()!==u?e=r=nt(i,l):(qe=e,e=u)):(qe=e,e=u)):(qe=e,e=u)}else qe=e,e=u}else qe=e,e=u}else qe=e,e=u;else qe=e,e=u;return e}(),r!==u){for(n=[],o=sr();o!==u;)n.push(o),o=sr();n!==u?((o=cr())===u&&(o=null),o!==u?e=r=V(r,n):(qe=e,e=u)):(qe=e,e=u)}else qe=e,e=u;return e}function cr(){var e,r,n,o;if(e=qe,38===t.charCodeAt(qe)?(r=$,qe++):(r=u,0===Je&&tr(Q)),r!==u){for(n=[],o=yr();o!==u;)n.push(o),o=yr();n!==u&&(o=dr())!==u?e=r=[r,n,o]:(qe=e,e=u)}else qe=e,e=u;return e}function fr(){var e,r,n;return e=qe,25104===t.charCodeAt(qe)?(r=at,qe++):(r=u,0===Je&&tr(ut)),r===u&&(r=null),r!==u?(bt.test(t.charAt(qe))?(n=t.charAt(qe),qe++):(n=u,0===Je&&tr(xt)),n!==u?e=r=wt(r,n):(qe=e,e=u)):(qe=e,e=u),e}function sr(){var e,r,n,o;if(e=qe,42===t.charCodeAt(qe)?(r=Gt,qe++):(r=u,0===Je&&tr(Lt)),r!==u){for(n=[],o=yr();o!==u;)n.push(o),o=yr();n!==u&&(o=dr())!==u?e=r=Yt(n):(qe=e,e=u)}else qe=e,e=u;if(e===u)if(e=qe,38===t.charCodeAt(qe)?(r=$,qe++):(r=u,0===Je&&tr(Q)),r!==u){for(n=[],o=yr();o!==u;)n.push(o),o=yr();n!==u&&(o=dr())!==u?e=r=_t(n):(qe=e,e=u)}else qe=e,e=u;return e}function hr(){var e,r,n,o,i,a;if(e=qe,t.substr(qe,3)===Te?(r=Te,qe+=3):(r=u,0===Je&&tr(Ue)),r!==u){for(n=[],32===t.charCodeAt(qe)?(o=A,qe++):(o=u,0===Je&&tr(K));o!==u;)n.push(o),32===t.charCodeAt(qe)?(o=A,qe++):(o=u,0===Je&&tr(K));if(n!==u){if(o=[],ot.test(t.charAt(qe))?(i=t.charAt(qe),qe++):(i=u,0===Je&&tr(it)),i!==u)for(;i!==u;)o.push(i),ot.test(t.charAt(qe))?(i=t.charAt(qe),qe++):(i=u,0===Je&&tr(it));else o=u;o!==u?(25163===t.charCodeAt(qe)?(i=qt,qe++):(i=u,0===Je&&tr(Zt)),i!==u&&dr()!==u&&(a=ur())!==u?e=r=Me(o,a):(qe=e,e=u)):(qe=e,e=u)}else qe=e,e=u}else qe=e,e=u;return e}function dr(){var t,e,r,n;if(t=qe,e=[],(r=mr())!==u)for(;r!==u;)e.push(r),r=mr();else e=u;if(e!==u){for(r=[],n=pr();n!==u;)r.push(n),n=pr();r!==u?t=e=[e,r]:(qe=t,t=u)}else qe=t,t=u;return t}function pr(){var e,r,n,o;if(e=qe,35===t.charCodeAt(qe)?(r=Pe,qe++):(r=u,0===Je&&tr(Re)),r!==u){for(n=[],o=yr();o!==u;)n.push(o),o=yr();n!==u&&(o=mr())!==u?e=r=[r,n,o]:(qe=e,e=u)}else qe=e,e=u;return e}function vr(){var e;return 32===t.charCodeAt(qe)?(e=A,qe++):(e=u,0===Je&&tr(K)),e===u&&(9===t.charCodeAt(qe)?(e=Ne,qe++):(e=u,0===Je&&tr(He))),e}function mr(){var e,r,n,o,i;for(e=qe,r=[],n=vr();n!==u;)r.push(n),n=vr();return r!==u?(10===t.charCodeAt(qe)?(n=Ge,qe++):(n=u,0===Je&&tr(Le)),n===u&&(n=qe,13===t.charCodeAt(qe)?(o=Ye,qe++):(o=u,0===Je&&tr(_e)),o!==u?(10===t.charCodeAt(qe)?(i=Ge,qe++):(i=u,0===Je&&tr(Le)),i===u&&(i=null),i!==u?n=o=[o,i]:(qe=n,n=u)):(qe=n,n=u)),n!==u?e=r=[r,n]:(qe=e,e=u)):(qe=e,e=u),e}function yr(){var e;return Be.test(t.charAt(qe))?(e=t.charAt(qe),qe++):(e=u,0===Je&&tr(We)),e}function gr(t){return parseInt(t.join(""),10)}function kr(t){switch(t.length){case 1:return"〇一二三四五六七八九十".indexOf(t);case 2:return"〇一二三四五六七八九十".indexOf(t[1])+10;default:throw"21以上の数値に対応していません"}}function br(t){if("成"==t[0])return{香:"NY",桂:"NK",銀:"NG"}[t[1]];const e={歩:"FU",香:"KY",桂:"KE",銀:"GI",金:"KI",角:"KA",飛:"HI",玉:"OU",王:"OU",と:"TO",杏:"NY",圭:"NK",全:"NG",馬:"UM",竜:"RY",龍:"RY"}[t];if(!e)throw"不明な駒 `"+t+"`";return e}function xr(t){var e=t.split(/[ 　]/),r={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0};if(""==t||"なし"==t)return r;for(var n=0;n<e.length;n++)""!=e[n]&&(r[br(e[n][0])]=1==e[n].length?1:kr(e[n].slice(1)));return r}if((n=c())!==u&&qe===t.length)return n;throw n!==u&&qe<t.length&&tr({type:"end"}),o=ze,i=De<t.length?t.charAt(De):null,a=De<t.length?Xe(De,De+1):Xe(De,De),new e(e.buildMessage(o,i),o,i,a)}}},738:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0})},671:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=r(426),o=r(557),i=r(704),a=function(){function t(t){this.forkPointers=[],this.forks_=null,this.currentStream_=null,this.shogi=new n.Shogi(t.initial||void 0),this.initialize(t)}return t.log=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.debug?console.log(e):t.logs.push(e)},t.parse=function(e,r){if(r){var n=r.split(".");switch(n[n.length-1].toLowerCase()){case"jkf":return t.parseJKF(e);case"kif":case"kifu":return t.parseKIF(e);case"ki2":case"ki2u":return t.parseKI2(e);case"csa":return t.parseCSA(e)}}try{return t.parseJKF(e)}catch(e){t.log("failed to parse as jkf",e)}try{return t.parseKIF(e)}catch(e){t.log("failed to parse as kif",e)}try{return t.parseKI2(e)}catch(e){t.log("failed to parse as ki2",e)}try{return t.parseCSA(e)}catch(e){t.log("failed to parse as csa",e)}throw new Error("JKF, KIF, KI2, CSAいずれの形式でも失敗しました")},t.parseJKF=function(e){return t.log("parseJKF",e),new t(JSON.parse(e))},t.parseKIF=function(e){return t.log("parseKIF",e),new t((0,i.parseKIF)(e))},t.parseKI2=function(e){return t.log("parseKI2",e),new t((0,i.parseKI2)(e))},t.parseCSA=function(e){return t.log("parseCSA",e),new t((0,i.parseCSA)(e))},t.numToZen=function(t){return"０１２３４５６７８９"[t]},t.numToKan=function(t){return"〇一二三四五六七八九"[t]},t.kindToKan=function(t){return(0,n.kindToString)(t)},t.relativeToKan=function(t){return{L:"左",C:"直",R:"右",U:"上",M:"寄",D:"引",H:"打"}[t]},t.specialToKan=function(t){return{TORYO:"投了",CHUDAN:"中断",SENNICHITE:"千日手",TIME_UP:"時間切れ",ILLEGAL_MOVE:"反則負け","+ILLEGAL_ACTION":"先手反則負け","-ILLEGAL_ACTION":"後手反則負け",JISHOGI:"持将棋",KACHI:"勝ち宣言",HIKIWAKE:"引き分け宣言",MATTA:"待った",TSUMI:"詰",FUZUMI:"不詰",ERROR:"エラー"}[t]||t},t.moveToReadableKifu=function(e){if(e.special)return t.specialToKan(e.special);var r=e.move,o=r.color===n.Color.Black?"☗":"☖";return r.same?o+="同　":o+=t.numToZen(r.to.x)+t.numToKan(r.to.y),o+=t.kindToKan(r.piece),r.relative&&(o+=r.relative.split("").map(t.relativeToKan).join("")),null!=r.promote&&(o+=r.promote?"成":"不成"),o},t.doMove=function(t,e){e&&(e.from?t.move(e.from.x,e.from.y,e.to.x,e.to.y,e.promote):t.drop(e.to.x,e.to.y,e.piece,void 0!==e.color?e.color:void 0))},t.undoMove=function(t,e){e&&(e.from?t.unmove(e.from.x,e.from.y,e.to.x,e.to.y,e.promote,e.capture):t.undrop(e.to.x,e.to.y))},t.getState=function(e){return{board:t.getBoardState(e),color:e.turn,hands:t.getHandsState(e)}},t.sameMoveMinimal=function(t,e){return t.to.x===e.to.x&&t.to.y===e.to.y&&(t.from&&e.from?t.from.x===e.from.x&&t.from.y===e.from.y&&t.promote===e.promote:t.piece===e.piece)},t.getBoardState=function(t){for(var e=[],r=1;r<=9;r++){for(var n=[],o=1;o<=9;o++){var i=t.get(r,o);n.push(i?{color:i.color,kind:i.kind}:{})}e.push(n)}return e},t.getHandsState=function(t){return[t.getHandsSummary(n.Color.Black),t.getHandsSummary(n.Color.White)]},Object.defineProperty(t.prototype,"forks",{get:function(){return null===this.forks_&&this.updateForksAndCurrentStream(),this.forks_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentStream",{get:function(){return null===this.currentStream_&&this.updateForksAndCurrentStream(),this.currentStream_},enumerable:!1,configurable:!0}),t.prototype.initialize=function(t){this.kifu=t,this.tesuu=0,this.forkPointers=[]},t.fromShogi=function(e){var r=new t({header:{},moves:[{}],initial:{preset:"OTHER",data:t.getState(e)}});return r.shogi=e,r},t.prototype.forward=function(){var e=this.getMoveFormat(this.tesuu+1);if(!e)return!1;this.tesuu++;var r=e.move;return!r||(t.log("forward",this.tesuu,r),this.doMove(r),!0)},t.prototype.backward=function(){var e=this;if(this.tesuu<=0)return!1;var r=this.getMoveFormat(this.tesuu).move;return t.log("backward",this.tesuu-1,r),this.undoMove(r),this.tesuu--,this.forkPointers=this.forkPointers.filter((function(t){return t.te<=e.tesuu})),this.updateForksAndCurrentStream(),!0},t.prototype.goto=function(t,e){var r;if("string"==typeof t){var n=t.indexOf(",");n>0?(r=Number(t.slice(0,n)),e=JSON.parse(t.slice(n+1))):r=Number(t)}else r=t;if(e){for(var o=!0,i=0;i<e.length;i++){var a=e[i],u=this.forkPointers[i];o&&u&&u.te===a.te&&u.forkIndex===a.forkIndex||(o=!1,this.goto(a.te-1),this.forkAndForward(a.forkIndex))}return o&&e.length<this.forkPointers.length&&this.goto(this.forkPointers[e.length].te-1),void this.goto(r)}if(!isNaN(r)){var l=1e4;if(this.tesuu<r)for(;this.tesuu!==r&&this.forward()&&l-- >0;);else for(;this.tesuu!==r&&this.backward()&&l-- >0;);if(0===l)throw new Error("tesuu overflows")}},t.prototype.go=function(t){"string"==typeof t&&(t=Number(t)),isNaN(t)||this.goto(this.tesuu+t)},t.prototype.forkAndForward=function(t){"string"==typeof t&&(t=parseInt(t,10));var e=this.getMoveFormat(this.tesuu+1);if(!e)throw new Error("".concat(this.tesuu+1,"手目に有効な棋譜がありません"));var r=e.forks;return!(!r||r.length<=t)&&(this.forkPointers.push({te:this.tesuu+1,forkIndex:t}),this.updateForksAndCurrentStream(),this.forward())},t.prototype.getTesuuPointer=function(t){return isNaN(t)&&(t=this.tesuu),"".concat(t,",").concat(JSON.stringify(this.getForkPointers(t)))},t.prototype.getForkPointers=function(t){return isNaN(t)&&(t=this.tesuu),this.forkPointers.filter((function(e){return e.te<=t}))},t.prototype.inputMove=function(e){if(this.getMoveFormat().special)throw new Error("終了局面へ棋譜を追加することは出来ません");if(null!=e.from&&null==e.promote){var r=this.shogi.get(e.from.x,e.from.y);if(!n.Piece.isPromoted(r.kind)&&n.Piece.canPromote(r.kind)&&((0,o.canPromote)(e.from,r.color)||(0,o.canPromote)(e.to,r.color)))return!1}var i=this.getMoveFormat(this.tesuu+1);if(i){if(i.move&&t.sameMoveMinimal(i.move,e))return this.forward(),!0;if(i.forks)for(var a=0;a<i.forks.length;a++){var u=i.forks[a][0];if(u&&u.move&&t.sameMoveMinimal(u.move,e))return this.forkAndForward(a),!0}}this.doMove(e);var l,c={move:e},f=this.tesuu<this.getMaxTesuu();return f?((l=this.getMoveFormat(this.tesuu+1)).forks||(l.forks=[]),l.forks.push([c])):this.forks[this.forks.length-1].moves.push(c),this.updateForksAndCurrentStream(),(0,o.normalizeMinimal)(this.kifu),this.undoMove(e),f?this.forkAndForward(l.forks.length-1):this.forward(),!0},t.prototype.getBoard=function(t,e){return this.shogi.get(t,e)},t.prototype.getComments=function(t){return void 0===t&&(t=this.tesuu),this.getMoveFormat(t).comments||[]},t.prototype.getMove=function(t){return void 0===t&&(t=this.tesuu),this.getMoveFormat(t).move},t.prototype.getReadableKifu=function(e){return void 0===e&&(e=this.tesuu),0===e?"開始局面":t.moveToReadableKifu(this.getMoveFormat(e))},t.prototype.getReadableForkKifu=function(e){return void 0===e&&(e=this.tesuu),this.getNextFork(e).map((function(e){return t.moveToReadableKifu(e[0])}))},t.prototype.getMaxTesuu=function(){return this.currentStream.length-1},t.prototype.toJKF=function(){return JSON.stringify(this.kifu)},t.prototype.getState=function(){return t.getState(this.shogi)},t.prototype.getReadableKifuState=function(){for(var t=[],e=0;e<=this.getMaxTesuu();e++)t.push({comments:this.getComments(e),forks:this.getReadableForkKifu(e-1),kifu:this.getReadableKifu(e),moveFormat:this.getMoveFormat(e)});return t},t.prototype.updateForksAndCurrentStream=function(){for(var t=[],e=[],r=this.kifu.moves,n=0,o=0,i=this.forkPointers;o<i.length;o++){var a=i[o];t.push({te:n,moves:r}),e=e.concat(r.slice(0,a.te-n)),r=r[a.te-n].forks[a.forkIndex],n=a.te}t.push({te:n,moves:r}),this.forks_=t,this.currentStream_=e.concat(r.slice())},t.prototype.getMoveFormat=function(t){return void 0===t&&(t=this.tesuu),this.currentStream[t]},t.prototype.getNextFork=function(t){void 0===t&&(t=this.tesuu);var e=this.getMoveFormat(t+1);return e&&e.forks?e.forks:[]},t.prototype.doMove=function(e){t.doMove(this.shogi,e)},t.prototype.undoMove=function(e){t.undoMove(this.shogi,e)},t.debug=!1,t.logs=[],t}();e.default=a},557:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.filterMovesByRelatives=e.addRelativeInformation=e.normalizeCSA=e.normalizeKI2=e.normalizeKIF=e.normalizeMinimal=e.canPromote=void 0;var n=r(426);function o(t,e){return e===n.Color.Black?t.y<=3:t.y>=7}function i(t,e,r){for(var a=0;a<e.length;a++){var u=0===a?r:e[a-1];if(f=e[a].move)if(f.color=t.turn,f.from){u&&u.move&&f.to.x===u.move.to.x&&f.to.y===u.move.to.y&&(f.same=!0),c(t,f),f.piece||(f.piece=t.get(f.from.x,f.from.y).kind),f.promote||n.Piece.isPromoted(f.piece)||!n.Piece.canPromote(f.piece)||(o(f.to,t.turn)||o(f.from,t.turn))&&(f.promote=!1),l(t,f);try{t.move(f.from.x,f.from.y,f.to.x,f.to.y,f.promote)}catch(t){throw new Error(a+"手目で失敗しました: "+t)}}else t.getMovesTo(f.to.x,f.to.y,f.piece).length>0&&(f.relative="H"),t.drop(f.to.x,f.to.y,f.piece)}for(m(e,t),a=e.length-1;a>=0;a--){var f;if((f=e[a].move)&&(f.from?t.unmove(f.from.x,f.from.y,f.to.x,f.to.y,f.promote,f.capture):t.undrop(f.to.x,f.to.y)),u=a<=1?r:e[a-1],e[a].forks)for(var s=0,h=e[a].forks;s<h.length;s++)i(t,h[s],u)}}function a(t,e,r){for(var i=0;i<e.length;i++){var u=0===i?r:e[i-1];if(f=e[i].move)if(f.color=t.turn,f.from){f.same&&(f.to=u.move.to),c(t,f),f.promote||n.Piece.isPromoted(f.piece)||!n.Piece.canPromote(f.piece)||(o(f.to,t.turn)||o(f.from,t.turn))&&(f.promote=!1),l(t,f);try{t.move(f.from.x,f.from.y,f.to.x,f.to.y,f.promote)}catch(t){throw new Error(i+"手目で失敗しました: "+t)}}else t.getMovesTo(f.to.x,f.to.y,f.piece).length>0&&(f.relative="H"),t.drop(f.to.x,f.to.y,f.piece)}for(m(e,t),i=e.length-1;i>=0;i--){var f;if((f=e[i].move)&&(f.from?t.unmove(f.from.x,f.from.y,f.to.x,f.to.y,f.promote,f.capture):t.undrop(f.to.x,f.to.y)),u=0===i?r:e[i-1],e[i].forks)for(var s=0,h=e[i].forks;s<h.length;s++)a(t,h[s],u)}}function u(t,e,r){for(var n=0;n<e.length;n++){var o=0===n?r:e[n-1];if(l=e[n].move){l.color=t.turn,l.same&&(l.to=o.move.to);var i=t.getMovesTo(l.to.x,l.to.y,l.piece);if("H"===l.relative||0===i.length);else if(1===i.length)l.from=i[0].from;else{var a=v(l.relative,t.turn,i);if(1!==a.length)throw new Error("相対情報が不完全で複数の候補があります");l.from=a[0].from}if(l.from){c(t,l);try{t.move(l.from.x,l.from.y,l.to.x,l.to.y,l.promote)}catch(t){throw new Error(n+"手目で失敗しました: "+t)}}else t.drop(l.to.x,l.to.y,l.piece)}}for(m(e,t),n=e.length-1;n>=0;n--){var l;if((l=e[n].move)&&(l.from?t.unmove(l.from.x,l.from.y,l.to.x,l.to.y,l.promote,l.capture):t.undrop(l.to.x,l.to.y),o=n<=1?r:e[n-1],e[n].forks))for(var f=0,s=e[n].forks;f<s.length;f++)u(t,s[f],o)}}function l(t,e){var r=t.getMovesTo(e.to.x,e.to.y,e.piece).map((function(e){return f(t.turn,h(e.to,e.from))}));if(r.length>=2){var n=f(t.turn,h(e.to,e.from));e.relative=1===r.filter((function(t){return t.y===n.y})).length?d(n.y):1===r.filter((function(t){return t.x===n.x})).length?"UM"!==e.piece&&"RY"!==e.piece||0!==n.x?p(n.x):p(0===r.filter((function(t){return t.x<0})).length?-1:1):0===n.x?p(n.x):p(n.x)+d(n.y)}}function c(t,e){var r=t.get(e.to.x,e.to.y);r&&(e.capture=r.kind)}function f(t,e){return t===n.Color.Black?e:{x:-e.x,y:-e.y}}function s(t,e){return t===e?0:t>e?1:-1}function h(t,e){return{x:s(t.x,e.x),y:s(t.y,e.y)}}function d(t){return 0===t?"M":t>0?"D":"U"}function p(t){return 0===t?"C":t>0?"R":"L"}function v(t,e,r){var n=r.map((function(t){return{move:t,vec:f(e,{x:t.to.x-t.from.x,y:t.to.y-t.from.y})}})).filter((function(e){var r=e.vec;return t.split("").every((function(t){return function(t,e,r){switch(t){case"U":return r.y<0;case"M":return 0===r.y;case"D":return r.y>0;case"C":return 0===r.x;case"L":case"R":return!0}}(t,0,r)}))}));if(t.indexOf("C")>=0&&(n=n.filter((function(t){return t.vec.y<0}))),t.indexOf("L")>=0){var o=1/0;return n.forEach((function(t){var e=t.vec;return o=Math.min(o,e.x)})),n.filter((function(t){return t.vec.x===o})).map((function(t){return t.move}))}if(t.indexOf("R")>=0){var i=-1/0;return n.forEach((function(t){var e=t.vec;return i=Math.max(i,e.x)})),n.filter((function(t){return t.vec.x===i})).map((function(t){return t.move}))}return n.map((function(t){return t.move}))}function m(t,e){t.length>=1&&"ILLEGAL_ACTION"===t[t.length-1].special&&(t[t.length-1].special=(e.turn?"+":"-")+"ILLEGAL_ACTION")}e.canPromote=o,e.normalizeMinimal=function(t){return i(new n.Shogi(t.initial),t.moves),t},e.normalizeKIF=function(t){return t.initial&&"HIRATE"===t.initial.preset&&t.initial.data&&(t.initial.preset="OTHER"),a(new n.Shogi(t.initial||void 0),t.moves),t},e.normalizeKI2=function(t){return u(new n.Shogi(t.initial||void 0),t.moves),t},e.normalizeCSA=function(t){!function(t){if(t.initial&&"OTHER"===t.initial.preset){for(var e=["FU","KY","KE","GI","KI","KA","HI"],r=0;r<2;r++)for(var o=0,i=e;o<i.length;o++){var a=i[o];if(0!==t.initial.data.hands[r][a])return}var u,l,c=[[{color:n.Color.White,kind:"KY"},{},{color:n.Color.White,kind:"FU"},{},{},{},{color:n.Color.Black,kind:"FU"},{},{color:n.Color.Black,kind:"KY"}],[{color:n.Color.White,kind:"KE"},{color:n.Color.White,kind:"KA"},{color:n.Color.White,kind:"FU"},{},{},{},{color:n.Color.Black,kind:"FU"},{color:n.Color.Black,kind:"HI"},{color:n.Color.Black,kind:"KE"}],[{color:n.Color.White,kind:"GI"},{},{color:n.Color.White,kind:"FU"},{},{},{},{color:n.Color.Black,kind:"FU"},{},{color:n.Color.Black,kind:"GI"}],[{color:n.Color.White,kind:"KI"},{},{color:n.Color.White,kind:"FU"},{},{},{},{color:n.Color.Black,kind:"FU"},{},{color:n.Color.Black,kind:"KI"}],[{color:n.Color.White,kind:"OU"},{},{color:n.Color.White,kind:"FU"},{},{},{},{color:n.Color.Black,kind:"FU"},{},{color:n.Color.Black,kind:"OU"}],[{color:n.Color.White,kind:"KI"},{},{color:n.Color.White,kind:"FU"},{},{},{},{color:n.Color.Black,kind:"FU"},{},{color:n.Color.Black,kind:"KI"}],[{color:n.Color.White,kind:"GI"},{},{color:n.Color.White,kind:"FU"},{},{},{},{color:n.Color.Black,kind:"FU"},{},{color:n.Color.Black,kind:"GI"}],[{color:n.Color.White,kind:"KE"},{color:n.Color.White,kind:"HI"},{color:n.Color.White,kind:"FU"},{},{},{},{color:n.Color.Black,kind:"FU"},{color:n.Color.Black,kind:"KA"},{color:n.Color.Black,kind:"KE"}],[{color:n.Color.White,kind:"KY"},{},{color:n.Color.White,kind:"FU"},{},{},{},{color:n.Color.Black,kind:"FU"},{},{color:n.Color.Black,kind:"KY"}]],f=[];for(r=0;r<9;r++)for(var s=0;s<9;s++)u=t.initial.data.board[r][s],l=c[r][s],void 0===u.color&&void 0===l.color||void 0!==u.color&&void 0!==l.color&&u.color===l.color&&u.kind===l.kind||f.push(""+(r+1)+(s+1));var h={"":"HIRATE"};h[11]="KY",h[91]="KY_R",h[22]="KA",h[82]="HI",h[1182]="HIKY",h[2282]="2",h[228291]="3",h[11228291]="4",h[1122818291]="5",h[1121228291]="5_L",h[112122818291]="6",h[0xa328d183c33]="7_L",h[0xa328f7a9633]="7_R",h[0x3fbbf1cdec333]="8",h["11212231416171818291"]="10";var d=h[f.sort().join("")];"HIRATE"===d?t.initial.data.color===n.Color.Black&&(t.initial.preset="HIRATE",delete t.initial.data):d&&t.initial.data.color===n.Color.White&&(t.initial.preset=d,delete t.initial.data)}}(t);for(var e=new n.Shogi(t.initial||void 0),r=0;r<t.moves.length;r++){u=t.moves[r].time,void 0===(f=r>=2?t.moves[r-2].time:void 0)&&(f={now:{m:0,s:0},total:{h:0,m:0,s:0}}),u&&(u.total={h:(u.now.h||0)+f.total.h,m:u.now.m+f.total.m,s:u.now.s+f.total.s},u.total.m+=Math.floor(u.total.s/60),u.total.s=u.total.s%60,u.total.h+=Math.floor(u.total.m/60),u.total.m=u.total.m%60);var i=t.moves[r].move;if(i)if(i.color=e.turn,i.from){if(r>0&&t.moves[r-1].move&&t.moves[r-1].move.to.x===i.to.x&&t.moves[r-1].move.to.y===i.to.y&&(i.same=!0),c(e,i),n.Piece.isPromoted(i.piece)){var a=e.get(i.from.x,i.from.y);a.kind!==i.piece&&(i.piece=a.kind,i.promote=!0)}else n.Piece.canPromote(i.piece)&&(o(i.to,e.turn)||o(i.from,e.turn))&&(i.promote=!1);l(e,i);try{e.move(i.from.x,i.from.y,i.to.x,i.to.y,i.promote)}catch(t){throw new Error(r+"手目で失敗しました: "+t)}}else e.getMovesTo(i.to.x,i.to.y,i.piece).length>0&&(i.relative="H"),e.drop(i.to.x,i.to.y,i.piece)}var u,f;return t},e.addRelativeInformation=l,e.filterMovesByRelatives=v},704:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parseKI2=e.parseKIF=e.parseCSA=void 0;var n=r(396),o=r(526),i=r(382),a=r(557);function u(t){return"\n"===t.slice(-1)?t:t+"\n"}e.parseCSA=function(t){t=u(t);var e=n.parse(t);return(0,a.normalizeCSA)(e)},e.parseKIF=function(t){t=u(t);var e=i.parse(t);return(0,a.normalizeKIF)(e)},e.parseKI2=function(t){t=u(t);var e=o.parse(t);return(0,a.normalizeKI2)(e)}},941:(t,e)=>{var r;e.__esModule=!0,e.colorToString=void 0,function(t){t[t.Black=0]="Black",t[t.White=1]="White"}(r||(r={})),e.default=r,e.colorToString=function(t){switch(t){case r.Black:return"先手";case r.White:return"後手"}}},142:(t,e)=>{var r;e.__esModule=!0,e.isRawKind=e.kindToString=e.values=void 0,function(t){t[t.FU=0]="FU",t[t.KY=1]="KY",t[t.KE=2]="KE",t[t.GI=3]="GI",t[t.KI=4]="KI",t[t.KA=5]="KA",t[t.HI=6]="HI",t[t.OU=7]="OU",t[t.TO=8]="TO",t[t.NY=9]="NY",t[t.NK=10]="NK",t[t.NG=11]="NG",t[t.UM=12]="UM",t[t.RY=13]="RY"}(r||(r={}));var n=["FU","KY","KE","GI","KI","KA","HI"];e.values=Object.keys(r).filter((function(t){return Number.isNaN(parseInt(t))})),e.kindToString=function(t,e){return void 0===e&&(e=!1),{FU:"歩",KY:"香",KE:"桂",GI:"銀",KI:"金",KA:"角",HI:"飛",OU:"玉",TO:"と",NY:e?"杏":"成香",NK:e?"圭":"成桂",NG:e?"全":"成銀",UM:"馬",RY:"龍"}[t]},e.isRawKind=function(t){return n.indexOf(t)>=0}},570:(t,e,r)=>{e.__esModule=!0;var n=r(941),o=function(){function t(t){this.color="+"===t.slice(0,1)?n.default.Black:n.default.White,this.kind=t.slice(1)}return t.promote=function(t){return{FU:"TO",KY:"NY",KE:"NK",GI:"NG",KA:"UM",HI:"RY"}[t]||t},t.unpromote=function(t){return{TO:"FU",NY:"KY",NK:"KE",NG:"GI",KI:"KI",UM:"KA",RY:"HI",OU:"OU"}[t]||t},t.canPromote=function(e){return t.promote(e)!==e},t.isPromoted=function(t){return["TO","NY","NK","NG","UM","RY"].indexOf(t)>=0},t.oppositeColor=function(t){return t===n.default.Black?n.default.White:n.default.Black},t.fromSFENString=function(e){var r="+"===e[0];r&&(e=e.slice(1));var n=new t((e.match(/[A-Z]/)?"+":"-")+{P:"FU",L:"KY",N:"KE",S:"GI",G:"KI",B:"KA",R:"HI",K:"OU"}[e.toUpperCase()]);return r&&n.promote(),n},t.prototype.promote=function(){this.kind=t.promote(this.kind)},t.prototype.unpromote=function(){this.kind=t.unpromote(this.kind)},t.prototype.inverse=function(){this.color=this.color===n.default.Black?n.default.White:n.default.Black},t.prototype.toCSAString=function(){return(this.color===n.default.Black?"+":"-")+this.kind},t.prototype.toSFENString=function(){var e={FU:"P",KY:"L",KE:"N",GI:"S",KI:"G",KA:"B",HI:"R",OU:"K"}[t.unpromote(this.kind)];return(t.isPromoted(this.kind)?"+":"")+(this.color===n.default.Black?e:e.toLowerCase())},t}();e.default=o},498:(t,e,r)=>{e.__esModule=!0,e.toSfen=e.fromSfen=e.toCSA=e.fromPreset=void 0;var n=r(941),o=r(458),i=r(570);e.fromPreset=function(t,e){var r,a=[],u=[[],[]];if("OTHER"!==e.preset){for(var l=(0,o.getInitialFromPreset)(e.preset),c=0;c<9;c++){a[c]=[];for(var f=0;f<9;f++){var s=l.board[f].slice(24-3*c,24-3*c+3);a[c][f]=" * "===s?null:new i.default(s)}}r=l.turn}else{for(c=0;c<9;c++)for(a[c]=[],f=0;f<9;f++){var h=e.data.board[c][f];a[c][f]=h.kind?new i.default((h.color===n.default.Black?"+":"-")+h.kind):null}r=e.data.color;for(var d=0;d<2;d++)for(var p in e.data.hands[d])if(e.data.hands[d].hasOwnProperty(p))for(s=(0===d?"+":"-")+p,c=0;c<e.data.hands[d][p];c++)u[d].push(new i.default(s))}t.board=a,t.turn=r,t.hands=u},e.toCSA=function(t){for(var e=[],r=0;r<9;r++){for(var o="P"+(r+1),i=8;i>=0;i--){var a=t.board[i][r];o+=null==a?" * ":a.toCSAString()}e.push(o)}for(var u=0;u<2;u++){o="P"+"+-"[u];for(var l=0,c=t.hands[u];l<c.length;l++)o+="00"+c[l].kind;e.push(o)}return e.push(t.turn===n.default.Black?"+":"-"),e.join("\n")},e.fromSfen=function(t,e){for(var r=[],o=0;o<9;o++){r[o]=[];for(var a=0;a<9;a++)r[o][a]=null}var u=e.split(" ");if("w"!==u[1]&&"b"!==u[1])throw new Error("Invalid SFEN");var l=u[0],c=8,f=0;for(o=0;o<l.length;o++){var s=l[o];"+"===s&&(s+=l[++o]),s.match(/^[1-9]$/)?c-=Number(s):"/"===s?(f++,c=8):(r[c][f]=i.default.fromSFENString(s),c--)}t.board=r,t.turn="b"===u[1]?n.default.Black:n.default.White;var h=[[],[]],d=u[2];if("-"!==d)for(;d.length>0;){var p=1,v=d.match(/^[0-9]+/);for(v&&(p=Number(v[0]),d=d.slice(v[0].length)),o=0;o<p;o++){var m=i.default.fromSFENString(d[0]);h[m.color].push(m)}d=d.slice(1)}t.hands=h},e.toSfen=function(t,e){for(var r=[],o=[],i=0;i<9;i++){for(var a="",u=0,l=8;l>=0;l--){var c=t.board[l][i];null==c?u++:(u>0&&(a+=""+u,u=0),a+=c.toSFENString())}u>0&&(a+=""+u),o.push(a)}if(r.push(o.join("/")),r.push(t.turn===n.default.Black?"b":"w"),0===t.hands[0].length&&0===t.hands[1].length)r.push("-");else{for(var f="",s={},h=0;h<2;h++)for(var d=0,p=t.hands[h];d<p.length;d++){var v=p[d].toSFENString();s[v]=(s[v]||0)+1}for(var m=0,y=["R","B","G","S","N","L","P","r","b","g","s","n","l","p"];m<y.length;m++){var g=y[m];s[g]>0&&(f+=(s[g]>1?s[g]:"")+g)}r.push(f)}return r.push(""+e),r.join(" ")}},757:(t,e)=>{e.__esModule=!0,e.getMoveDefinitions=void 0;var r=[0,-1],n=[0,1],o=[1,0],i=[-1,0],a=[-1,-1],u=[1,-1],l=[-1,1],c=[1,1],f={just:[a,r,u,i,o,n]},s={FU:{just:[r]},KY:{fly:[r]},KE:{just:[[-1,-2],[1,-2]]},GI:{just:[a,r,u,l,c]},KI:f,TO:f,NY:f,NK:f,NG:f,KA:{fly:[a,u,l,c]},HI:{fly:[r,i,o,n]},OU:{just:[a,r,u,i,o,l,n,c]},UM:{fly:[a,u,l,c],just:[r,i,o,n]},RY:{fly:[r,i,o,n],just:[a,u,l,c]}};e.getMoveDefinitions=function(t){return s[t]}},989:(t,e)=>{e.__esModule=!0,Array.prototype.some||(Array.prototype.some=function(t){if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=arguments[1],o=0;o<r;o++)if(o in e&&t.call(n,e[o],o,e))return!0;return!1})},458:(t,e,r)=>{e.__esModule=!0,e.getInitialFromPreset=void 0;var n=r(941),o=" *  *  *  *  *  *  *  *  * ",i=["-FU-FU-FU-FU-FU-FU-FU-FU-FU",o,o,o,"+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],a=[o].concat(i),u={HIRATE:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  * -KA * "].concat(i),turn:n.default.Black},KY:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "," * -HI *  *  *  *  * -KA * "].concat(i),turn:n.default.White},KY_R:{board:[" * -KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  * -KA * "].concat(i),turn:n.default.White},KA:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  *  *  * "].concat(i),turn:n.default.White},HI:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," *  *  *  *  *  *  * -KA * "].concat(i),turn:n.default.White},HIKY:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "," *  *  *  *  *  *  * -KA * "].concat(i),turn:n.default.White},2:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"].concat(a),turn:n.default.White},3:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "].concat(a),turn:n.default.White},4:{board:[" * -KE-GI-KI-OU-KI-GI-KE * "].concat(a),turn:n.default.White},5:{board:[" *  * -GI-KI-OU-KI-GI-KE * "].concat(a),turn:n.default.White},"5_L":{board:[" * -KE-GI-KI-OU-KI-GI *  * "].concat(a),turn:n.default.White},6:{board:[" *  * -GI-KI-OU-KI-GI *  * "].concat(a),turn:n.default.White},"7_R":{board:[" *  *  * -KI-OU-KI-GI *  * "].concat(a),turn:n.default.White},"7_L":{board:[" *  * -GI-KI-OU-KI *  *  * "].concat(a),turn:n.default.White},8:{board:[" *  *  * -KI-OU-KI *  *  * "].concat(a),turn:n.default.White},10:{board:[" *  *  *  * -OU *  *  *  * "].concat(a),turn:n.default.White}};e.getInitialFromPreset=function(t){var e=u[t];if(!e)throw new Error("Unknown preset: ".concat(t));return e};var l=Object.keys(u);e.default=l},426:(t,e,r)=>{e.__esModule=!0,e.colorToString=e.kindToString=e.Piece=e.Color=e.Shogi=void 0;var n=r(941);e.Color=n.default,e.colorToString=n.colorToString;var o=r(142);e.kindToString=o.kindToString;var i=r(757),a=r(570);e.Piece=a.default,r(989);var u=r(498),l=function(){function t(t){this.initialize(t)}return t.getIllegalUnpromotedRow=function(t){switch(t){case"FU":case"KY":return 1;case"KE":return 2;default:return 0}},t.getRowToOppositeEnd=function(t,e){return e===n.default.Black?t:10-t},t.prototype.initialize=function(t){void 0===t&&(t={preset:"HIRATE"}),(0,u.fromPreset)(this,t),this.flagEditMode=!1},t.prototype.initializeFromSFENString=function(t){(0,u.fromSfen)(this,t)},t.prototype.toCSAString=function(){return(0,u.toCSA)(this)},t.prototype.toSFENString=function(t){return void 0===t&&(t=1),(0,u.toSfen)(this,t)},t.prototype.editMode=function(t){this.flagEditMode=t},t.prototype.move=function(e,r,n,o,i){void 0===i&&(i=!1);var a=this.get(e,r);if(null==a)throw new Error("no piece found at "+e+", "+r);if(this.checkTurn(a.color),!this.flagEditMode&&!this.getMovesFrom(e,r).some((function(t){return t.to.x===n&&t.to.y===o})))throw new Error("cannot move from "+e+", "+r+" to "+n+", "+o);null!=this.get(n,o)&&this.capture(n,o);var u=t.getIllegalUnpromotedRow(a.kind)>=t.getRowToOppositeEnd(o,a.color);(i||u)&&a.promote(),this.set(n,o,a),this.set(e,r,null),this.nextTurn()},t.prototype.unmove=function(t,e,r,n,o,i){void 0===o&&(o=!1);var u,l=this.get(r,n);if(null==l)throw new Error("no piece found at "+r+", "+n);this.checkTurn(a.default.oppositeColor(l.color)),i&&(u=this.popFromHand(a.default.unpromote(i),l.color)).inverse();var c=this.flagEditMode;this.editMode(!0),this.move(r,n,t,e),o&&l.unpromote(),i&&(a.default.isPromoted(i)&&u.promote(),this.set(r,n,u)),this.editMode(c),this.prevTurn()},t.prototype.drop=function(t,e,r,n){if(void 0===n&&(n=this.turn),this.checkTurn(n),null!=this.get(t,e))throw new Error("there is a piece at "+t+", "+e);if(!this.getDropsBy(n).some((function(n){return n.to.x===t&&n.to.y===e&&n.kind===r})))throw new Error("Cannot move");var o=this.popFromHand(r,n);this.set(t,e,o),this.nextTurn()},t.prototype.undrop=function(t,e){var r=this.get(t,e);if(null==r)throw new Error("there is no piece at "+t+", "+e);this.checkTurn(a.default.oppositeColor(r.color)),this.pushToHand(r),this.set(t,e,null),this.prevTurn()},t.prototype.getMovesFrom=function(t,e){var r=function(t,e,r){if(t<1||9<t||e<1||9<e)return!1;var n=this.get(t,e);return null==n||n.color!==r}.bind(this),o=function(t,e,r){var n=this.get(t,e);return null!=n&&n.color!==r}.bind(this),a=this.get(t,e);if(null==a)return[];var u=(0,i.getMoveDefinitions)(a.kind),l=[],c={x:t,y:e},f=a.color===n.default.Black?1:-1;if(u.just)for(var s=0,h=u.just;s<h.length;s++){var d=h[s];r((m={x:c.x+d[0]*f,y:c.y+d[1]*f}).x,m.y,a.color)&&l.push({from:c,to:m})}if(u.fly)for(var p=0,v=u.fly;p<v.length;p++){d=v[p];for(var m={x:c.x+d[0]*f,y:c.y+d[1]*f};r(m.x,m.y,a.color)&&(l.push({from:c,to:{x:m.x,y:m.y}}),!o(m.x,m.y,a.color));)m.x+=d[0]*f,m.y+=d[1]*f}return l},t.prototype.getDropsBy=function(e){for(var r=[],n=[],o=[],i=1;i<=9;i++){for(var a=!1,u=1;u<=9;u++){var l=this.get(i,u);null==l?n.push({x:i,y:u}):l.color===e&&"FU"===l.kind&&(a=!0)}o.push(a)}for(var c={},f=0,s=this.hands[e];f<s.length;f++){var h=s[f].kind;if(!c[h]){c[h]=!0;for(var d=t.getIllegalUnpromotedRow(h),p=0,v=n;p<v.length;p++){var m=v[p];"FU"===h&&o[m.x-1]||d>=t.getRowToOppositeEnd(m.y,e)||r.push({to:m,color:e,kind:h})}}}return r},t.prototype.getMovesTo=function(t,e,r,n){void 0===n&&(n=this.turn);for(var o={x:t,y:e},i=[],a=1;a<=9;a++)for(var u=1;u<=9;u++){var l=this.get(a,u);l&&l.kind===r&&l.color===n&&this.getMovesFrom(a,u).some((function(r){return r.to.x===t&&r.to.y===e}))&&i.push({from:{x:a,y:u},to:o})}return i},t.prototype.get=function(t,e){return this.board[t-1][e-1]},t.prototype.getHandsSummary=function(t){for(var e={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0},r=0,n=this.hands[t];r<n.length;r++)e[n[r].kind]++;return e},t.prototype.captureByColor=function(t,e,r){if(!this.flagEditMode)throw new Error("cannot edit board without editMode");var n=this.get(t,e);this.set(t,e,null),n.unpromote(),n.color!==r&&n.inverse(),this.pushToHand(n)},t.prototype.flip=function(t,e){if(!this.flagEditMode)throw new Error("cannot edit board without editMode");var r=this.get(t,e);return!!r&&(a.default.isPromoted(r.kind)?(r.unpromote(),r.inverse()):a.default.canPromote(r.kind)?r.promote():r.inverse(),!0)},t.prototype.setTurn=function(t){if(!this.flagEditMode)throw new Error("cannot set turn without editMode");this.turn=t},t.prototype.set=function(t,e,r){this.board[t-1][e-1]=r},t.prototype.capture=function(t,e){var r=this.get(t,e);this.set(t,e,null),r.unpromote(),r.inverse(),this.pushToHand(r)},t.prototype.pushToHand=function(t){this.hands[t.color].push(t)},t.prototype.popFromHand=function(t,e){for(var r=this.hands[e],n=0;n<r.length;n++)if(r[n].kind===t){var o=r[n];return r.splice(n,1),o}throw new Error(e+" has no "+t)},t.prototype.nextTurn=function(){this.flagEditMode||(this.turn=this.turn===n.default.Black?n.default.White:n.default.Black)},t.prototype.prevTurn=function(){this.flagEditMode||this.nextTurn()},t.prototype.checkTurn=function(t){if(!this.flagEditMode&&t!==this.turn)throw new Error("cannot move opposite piece")},t}();e.Shogi=l}},r={};function n(t){var o=r[t];if(void 0!==o)return o.exports;var i=r[t]={exports:{}};return e[t](i,i.exports,n),i.exports}var o={};(()=>{var t=o;Object.defineProperty(t,"__esModule",{value:!0}),t.Shogi=t.Formats=t.Parsers=t.JKFPlayer=t.Normalizer=void 0;var e=n(426);t.Shogi=e;var r=n(738);t.Formats=r;var i=n(671);t.JKFPlayer=i.default;var a=n(557);t.Normalizer=a;var u=n(704);t.Parsers=u})(),t.exports=o})()},1941:(t,e)=>{"use strict";var r;e.__esModule=!0,e.colorToString=void 0,function(t){t[t.Black=0]="Black",t[t.White=1]="White"}(r||(r={})),e.default=r,e.colorToString=function(t){switch(t){case r.Black:return"先手";case r.White:return"後手"}}},1142:(t,e)=>{"use strict";var r;e.__esModule=!0,e.isRawKind=e.kindToString=e.values=void 0,function(t){t[t.FU=0]="FU",t[t.KY=1]="KY",t[t.KE=2]="KE",t[t.GI=3]="GI",t[t.KI=4]="KI",t[t.KA=5]="KA",t[t.HI=6]="HI",t[t.OU=7]="OU",t[t.TO=8]="TO",t[t.NY=9]="NY",t[t.NK=10]="NK",t[t.NG=11]="NG",t[t.UM=12]="UM",t[t.RY=13]="RY"}(r||(r={}));var n=["FU","KY","KE","GI","KI","KA","HI"];e.values=Object.keys(r).filter((function(t){return Number.isNaN(parseInt(t))})),e.kindToString=function(t,e){return void 0===e&&(e=!1),{FU:"歩",KY:"香",KE:"桂",GI:"銀",KI:"金",KA:"角",HI:"飛",OU:"玉",TO:"と",NY:e?"杏":"成香",NK:e?"圭":"成桂",NG:e?"全":"成銀",UM:"馬",RY:"龍"}[t]},e.isRawKind=function(t){return n.indexOf(t)>=0}},1570:(t,e,r)=>{"use strict";e.__esModule=!0;var n=r(1941),o=function(){function t(t){this.color="+"===t.slice(0,1)?n.default.Black:n.default.White,this.kind=t.slice(1)}return t.promote=function(t){return{FU:"TO",KY:"NY",KE:"NK",GI:"NG",KA:"UM",HI:"RY"}[t]||t},t.unpromote=function(t){return{TO:"FU",NY:"KY",NK:"KE",NG:"GI",KI:"KI",UM:"KA",RY:"HI",OU:"OU"}[t]||t},t.canPromote=function(e){return t.promote(e)!==e},t.isPromoted=function(t){return["TO","NY","NK","NG","UM","RY"].indexOf(t)>=0},t.oppositeColor=function(t){return t===n.default.Black?n.default.White:n.default.Black},t.fromSFENString=function(e){var r="+"===e[0];r&&(e=e.slice(1));var n=new t((e.match(/[A-Z]/)?"+":"-")+{P:"FU",L:"KY",N:"KE",S:"GI",G:"KI",B:"KA",R:"HI",K:"OU"}[e.toUpperCase()]);return r&&n.promote(),n},t.prototype.promote=function(){this.kind=t.promote(this.kind)},t.prototype.unpromote=function(){this.kind=t.unpromote(this.kind)},t.prototype.inverse=function(){this.color=this.color===n.default.Black?n.default.White:n.default.Black},t.prototype.toCSAString=function(){return(this.color===n.default.Black?"+":"-")+this.kind},t.prototype.toSFENString=function(){var e={FU:"P",KY:"L",KE:"N",GI:"S",KI:"G",KA:"B",HI:"R",OU:"K"}[t.unpromote(this.kind)];return(t.isPromoted(this.kind)?"+":"")+(this.color===n.default.Black?e:e.toLowerCase())},t}();e.default=o},3498:(t,e,r)=>{"use strict";e.__esModule=!0,e.toSfen=e.fromSfen=e.toCSA=e.fromPreset=void 0;var n=r(1941),o=r(9458),i=r(1570);e.fromPreset=function(t,e){var r,a=[],u=[[],[]];if("OTHER"!==e.preset){for(var l=(0,o.getInitialFromPreset)(e.preset),c=0;c<9;c++){a[c]=[];for(var f=0;f<9;f++){var s=l.board[f].slice(24-3*c,24-3*c+3);a[c][f]=" * "===s?null:new i.default(s)}}r=l.turn}else{for(c=0;c<9;c++)for(a[c]=[],f=0;f<9;f++){var h=e.data.board[c][f];a[c][f]=h.kind?new i.default((h.color===n.default.Black?"+":"-")+h.kind):null}r=e.data.color;for(var d=0;d<2;d++)for(var p in e.data.hands[d])if(e.data.hands[d].hasOwnProperty(p))for(s=(0===d?"+":"-")+p,c=0;c<e.data.hands[d][p];c++)u[d].push(new i.default(s))}t.board=a,t.turn=r,t.hands=u},e.toCSA=function(t){for(var e=[],r=0;r<9;r++){for(var o="P"+(r+1),i=8;i>=0;i--){var a=t.board[i][r];o+=null==a?" * ":a.toCSAString()}e.push(o)}for(var u=0;u<2;u++){o="P"+"+-"[u];for(var l=0,c=t.hands[u];l<c.length;l++)o+="00"+c[l].kind;e.push(o)}return e.push(t.turn===n.default.Black?"+":"-"),e.join("\n")},e.fromSfen=function(t,e){for(var r=[],o=0;o<9;o++){r[o]=[];for(var a=0;a<9;a++)r[o][a]=null}var u=e.split(" ");if("w"!==u[1]&&"b"!==u[1])throw new Error("Invalid SFEN");var l=u[0],c=8,f=0;for(o=0;o<l.length;o++){var s=l[o];"+"===s&&(s+=l[++o]),s.match(/^[1-9]$/)?c-=Number(s):"/"===s?(f++,c=8):(r[c][f]=i.default.fromSFENString(s),c--)}t.board=r,t.turn="b"===u[1]?n.default.Black:n.default.White;var h=[[],[]],d=u[2];if("-"!==d)for(;d.length>0;){var p=1,v=d.match(/^[0-9]+/);for(v&&(p=Number(v[0]),d=d.slice(v[0].length)),o=0;o<p;o++){var m=i.default.fromSFENString(d[0]);h[m.color].push(m)}d=d.slice(1)}t.hands=h},e.toSfen=function(t,e){for(var r=[],o=[],i=0;i<9;i++){for(var a="",u=0,l=8;l>=0;l--){var c=t.board[l][i];null==c?u++:(u>0&&(a+=""+u,u=0),a+=c.toSFENString())}u>0&&(a+=""+u),o.push(a)}if(r.push(o.join("/")),r.push(t.turn===n.default.Black?"b":"w"),0===t.hands[0].length&&0===t.hands[1].length)r.push("-");else{for(var f="",s={},h=0;h<2;h++)for(var d=0,p=t.hands[h];d<p.length;d++){var v=p[d].toSFENString();s[v]=(s[v]||0)+1}for(var m=0,y=["R","B","G","S","N","L","P","r","b","g","s","n","l","p"];m<y.length;m++){var g=y[m];s[g]>0&&(f+=(s[g]>1?s[g]:"")+g)}r.push(f)}return r.push(""+e),r.join(" ")}},5757:(t,e)=>{"use strict";e.__esModule=!0,e.getMoveDefinitions=void 0;var r=[0,-1],n=[0,1],o=[1,0],i=[-1,0],a=[-1,-1],u=[1,-1],l=[-1,1],c=[1,1],f={just:[a,r,u,i,o,n]},s={FU:{just:[r]},KY:{fly:[r]},KE:{just:[[-1,-2],[1,-2]]},GI:{just:[a,r,u,l,c]},KI:f,TO:f,NY:f,NK:f,NG:f,KA:{fly:[a,u,l,c]},HI:{fly:[r,i,o,n]},OU:{just:[a,r,u,i,o,l,n,c]},UM:{fly:[a,u,l,c],just:[r,i,o,n]},RY:{fly:[r,i,o,n],just:[a,u,l,c]}};e.getMoveDefinitions=function(t){return s[t]}},8989:(t,e)=>{"use strict";e.__esModule=!0,Array.prototype.some||(Array.prototype.some=function(t){if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=arguments[1],o=0;o<r;o++)if(o in e&&t.call(n,e[o],o,e))return!0;return!1})},9458:(t,e,r)=>{"use strict";e.__esModule=!0,e.getInitialFromPreset=void 0;var n=r(1941),o=" *  *  *  *  *  *  *  *  * ",i=["-FU-FU-FU-FU-FU-FU-FU-FU-FU",o,o,o,"+FU+FU+FU+FU+FU+FU+FU+FU+FU"," * +KA *  *  *  *  * +HI * ","+KY+KE+GI+KI+OU+KI+GI+KE+KY"],a=[o].concat(i),u={HIRATE:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  * -KA * "].concat(i),turn:n.default.Black},KY:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "," * -HI *  *  *  *  * -KA * "].concat(i),turn:n.default.White},KY_R:{board:[" * -KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  * -KA * "].concat(i),turn:n.default.White},KA:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," * -HI *  *  *  *  *  *  * "].concat(i),turn:n.default.White},HI:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"," *  *  *  *  *  *  * -KA * "].concat(i),turn:n.default.White},HIKY:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "," *  *  *  *  *  *  * -KA * "].concat(i),turn:n.default.White},2:{board:["-KY-KE-GI-KI-OU-KI-GI-KE-KY"].concat(a),turn:n.default.White},3:{board:["-KY-KE-GI-KI-OU-KI-GI-KE * "].concat(a),turn:n.default.White},4:{board:[" * -KE-GI-KI-OU-KI-GI-KE * "].concat(a),turn:n.default.White},5:{board:[" *  * -GI-KI-OU-KI-GI-KE * "].concat(a),turn:n.default.White},"5_L":{board:[" * -KE-GI-KI-OU-KI-GI *  * "].concat(a),turn:n.default.White},6:{board:[" *  * -GI-KI-OU-KI-GI *  * "].concat(a),turn:n.default.White},"7_R":{board:[" *  *  * -KI-OU-KI-GI *  * "].concat(a),turn:n.default.White},"7_L":{board:[" *  * -GI-KI-OU-KI *  *  * "].concat(a),turn:n.default.White},8:{board:[" *  *  * -KI-OU-KI *  *  * "].concat(a),turn:n.default.White},10:{board:[" *  *  *  * -OU *  *  *  * "].concat(a),turn:n.default.White}};e.getInitialFromPreset=function(t){var e=u[t];if(!e)throw new Error("Unknown preset: ".concat(t));return e};var l=Object.keys(u);e.default=l},1426:(t,e,r)=>{"use strict";e.ZO=e.Il=e.WZ=void 0;var n=r(1941);e.Il=n.default,n.colorToString;var o=r(1142);e.ZO=o.kindToString;var i=r(5757),a=r(1570);a.default,r(8989);var u=r(3498),l=function(){function t(t){this.initialize(t)}return t.getIllegalUnpromotedRow=function(t){switch(t){case"FU":case"KY":return 1;case"KE":return 2;default:return 0}},t.getRowToOppositeEnd=function(t,e){return e===n.default.Black?t:10-t},t.prototype.initialize=function(t){void 0===t&&(t={preset:"HIRATE"}),(0,u.fromPreset)(this,t),this.flagEditMode=!1},t.prototype.initializeFromSFENString=function(t){(0,u.fromSfen)(this,t)},t.prototype.toCSAString=function(){return(0,u.toCSA)(this)},t.prototype.toSFENString=function(t){return void 0===t&&(t=1),(0,u.toSfen)(this,t)},t.prototype.editMode=function(t){this.flagEditMode=t},t.prototype.move=function(e,r,n,o,i){void 0===i&&(i=!1);var a=this.get(e,r);if(null==a)throw new Error("no piece found at "+e+", "+r);if(this.checkTurn(a.color),!this.flagEditMode&&!this.getMovesFrom(e,r).some((function(t){return t.to.x===n&&t.to.y===o})))throw new Error("cannot move from "+e+", "+r+" to "+n+", "+o);null!=this.get(n,o)&&this.capture(n,o);var u=t.getIllegalUnpromotedRow(a.kind)>=t.getRowToOppositeEnd(o,a.color);(i||u)&&a.promote(),this.set(n,o,a),this.set(e,r,null),this.nextTurn()},t.prototype.unmove=function(t,e,r,n,o,i){void 0===o&&(o=!1);var u,l=this.get(r,n);if(null==l)throw new Error("no piece found at "+r+", "+n);this.checkTurn(a.default.oppositeColor(l.color)),i&&(u=this.popFromHand(a.default.unpromote(i),l.color)).inverse();var c=this.flagEditMode;this.editMode(!0),this.move(r,n,t,e),o&&l.unpromote(),i&&(a.default.isPromoted(i)&&u.promote(),this.set(r,n,u)),this.editMode(c),this.prevTurn()},t.prototype.drop=function(t,e,r,n){if(void 0===n&&(n=this.turn),this.checkTurn(n),null!=this.get(t,e))throw new Error("there is a piece at "+t+", "+e);if(!this.getDropsBy(n).some((function(n){return n.to.x===t&&n.to.y===e&&n.kind===r})))throw new Error("Cannot move");var o=this.popFromHand(r,n);this.set(t,e,o),this.nextTurn()},t.prototype.undrop=function(t,e){var r=this.get(t,e);if(null==r)throw new Error("there is no piece at "+t+", "+e);this.checkTurn(a.default.oppositeColor(r.color)),this.pushToHand(r),this.set(t,e,null),this.prevTurn()},t.prototype.getMovesFrom=function(t,e){var r=function(t,e,r){if(t<1||9<t||e<1||9<e)return!1;var n=this.get(t,e);return null==n||n.color!==r}.bind(this),o=function(t,e,r){var n=this.get(t,e);return null!=n&&n.color!==r}.bind(this),a=this.get(t,e);if(null==a)return[];var u=(0,i.getMoveDefinitions)(a.kind),l=[],c={x:t,y:e},f=a.color===n.default.Black?1:-1;if(u.just)for(var s=0,h=u.just;s<h.length;s++){var d=h[s];r((m={x:c.x+d[0]*f,y:c.y+d[1]*f}).x,m.y,a.color)&&l.push({from:c,to:m})}if(u.fly)for(var p=0,v=u.fly;p<v.length;p++){d=v[p];for(var m={x:c.x+d[0]*f,y:c.y+d[1]*f};r(m.x,m.y,a.color)&&(l.push({from:c,to:{x:m.x,y:m.y}}),!o(m.x,m.y,a.color));)m.x+=d[0]*f,m.y+=d[1]*f}return l},t.prototype.getDropsBy=function(e){for(var r=[],n=[],o=[],i=1;i<=9;i++){for(var a=!1,u=1;u<=9;u++){var l=this.get(i,u);null==l?n.push({x:i,y:u}):l.color===e&&"FU"===l.kind&&(a=!0)}o.push(a)}for(var c={},f=0,s=this.hands[e];f<s.length;f++){var h=s[f].kind;if(!c[h]){c[h]=!0;for(var d=t.getIllegalUnpromotedRow(h),p=0,v=n;p<v.length;p++){var m=v[p];"FU"===h&&o[m.x-1]||d>=t.getRowToOppositeEnd(m.y,e)||r.push({to:m,color:e,kind:h})}}}return r},t.prototype.getMovesTo=function(t,e,r,n){void 0===n&&(n=this.turn);for(var o={x:t,y:e},i=[],a=1;a<=9;a++)for(var u=1;u<=9;u++){var l=this.get(a,u);l&&l.kind===r&&l.color===n&&this.getMovesFrom(a,u).some((function(r){return r.to.x===t&&r.to.y===e}))&&i.push({from:{x:a,y:u},to:o})}return i},t.prototype.get=function(t,e){return this.board[t-1][e-1]},t.prototype.getHandsSummary=function(t){for(var e={FU:0,KY:0,KE:0,GI:0,KI:0,KA:0,HI:0},r=0,n=this.hands[t];r<n.length;r++)e[n[r].kind]++;return e},t.prototype.captureByColor=function(t,e,r){if(!this.flagEditMode)throw new Error("cannot edit board without editMode");var n=this.get(t,e);this.set(t,e,null),n.unpromote(),n.color!==r&&n.inverse(),this.pushToHand(n)},t.prototype.flip=function(t,e){if(!this.flagEditMode)throw new Error("cannot edit board without editMode");var r=this.get(t,e);return!!r&&(a.default.isPromoted(r.kind)?(r.unpromote(),r.inverse()):a.default.canPromote(r.kind)?r.promote():r.inverse(),!0)},t.prototype.setTurn=function(t){if(!this.flagEditMode)throw new Error("cannot set turn without editMode");this.turn=t},t.prototype.set=function(t,e,r){this.board[t-1][e-1]=r},t.prototype.capture=function(t,e){var r=this.get(t,e);this.set(t,e,null),r.unpromote(),r.inverse(),this.pushToHand(r)},t.prototype.pushToHand=function(t){this.hands[t.color].push(t)},t.prototype.popFromHand=function(t,e){for(var r=this.hands[e],n=0;n<r.length;n++)if(r[n].kind===t){var o=r[n];return r.splice(n,1),o}throw new Error(e+" has no "+t)},t.prototype.nextTurn=function(){this.flagEditMode||(this.turn=this.turn===n.default.Black?n.default.White:n.default.Black)},t.prototype.prevTurn=function(){this.flagEditMode||this.nextTurn()},t.prototype.checkTurn=function(t){if(!this.flagEditMode&&t!==this.turn)throw new Error("cannot move opposite piece")},t}();e.WZ=l}}]);